import{d as ee,u as te,r as g,l as O,o as se,w as oe,c as a,a as t,b as D,t as T,F as R,g as W,f as m,v as P,m as L,h as p,n as le,j as r}from"./index-BH0FCm0V.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"p-4 sm:p-6 md:p-8 max-w-4xl mx-auto"},re={class:"bg-white p-6 rounded-lg shadow-md"},ie={class:"mb-6"},de={class:"flex justify-between items-center mb-4"},ue={class:"text-xl font-semibold"},ce={class:"grid grid-cols-7 gap-1 text-center"},ve=["onClick"],ge={class:"font-medium"},me={class:"flex-grow flex flex-col justify-center items-center space-y-1 w-full"},pe={key:0,class:"text-xs text-white bg-red-500/90 rounded-full px-2 py-0.5 inline-block"},fe={key:1,class:"text-xs text-white bg-purple-500/90 rounded-full px-2 py-0.5 inline-block"},be={key:2,class:"text-xs text-white bg-pink-400/90 rounded-full px-2 py-0.5 inline-block"},xe={key:3,class:"text-red-500"},we={key:0,class:"mt-8"},ye={class:"text-lg font-semibold mb-4"},_e={key:0},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},he={class:"mb-4"},De={key:1},Te={class:"border-t pt-4 mt-6"},Se={key:0},Ce={key:1},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ee={class:"mb-4"},Oe=ee({__name:"PeriodTrackerView",setup(Pe){const f=s=>{const e=s.split("T")[0].split("-").map(Number);return new Date(e[0],e[1]-1,e[2])},w=s=>{const e=s.getFullYear(),o=(s.getMonth()+1).toString().padStart(2,"0"),i=s.getDate().toString().padStart(2,"0");return`${e}-${o}-${i}`},u=te(),V=new Date;V.setHours(0,0,0,0);const S=g(new Date(V)),n=g(null),$=g([]),C=g([]),b=g(null),c=g(null),x=g(!1),l=g({start_date:"",end_date:"",pain_level:"无",flow_volume:"正常",notes:""}),B=["日","一","二","三","四","五","六"],G=O(()=>{if(!n.value)return!1;const s=w(n.value);return C.value.includes(s)}),M=O(()=>S.value.getFullYear()),E=O(()=>S.value.getMonth()),I=O(()=>{const s=M.value,e=E.value,o=new Date(s,e,1),v=new Date(s,e+1,0).getDate(),_=o.getDay(),k=[],X=new Date(s,e,0).getDate();for(let d=_-1;d>=0;d--){const h=new Date(s,e-1,X-d);k.push(U(h,!1))}for(let d=1;d<=v;d++){const h=new Date(s,e,d);k.push(U(h,!0))}const Z=42-k.length;for(let d=1;d<=Z;d++){const h=new Date(s,e+1,d);k.push(U(h,!1))}return k}),U=(s,e)=>{const o={date:s,isCurrentMonth:e,isToday:s.getTime()===V.getTime(),isSelected:n.value?.getTime()===s.getTime(),isPeriod:!1,isFertile:!1,isOvulation:!1,isSexDay:C.value.includes(w(s))};for(const i of $.value){const v=f(i.start_date),_=i.end_date?f(i.end_date):v;if(s>=v&&s<=_){o.isPeriod=!0;break}}if(b.value&&b.value.fertileWindow&&b.value.ovulationDate){const i=f(b.value.fertileWindow.start),v=f(b.value.fertileWindow.end),_=f(b.value.ovulationDate);s>=i&&s<=v&&(o.isFertile=!0),s.getTime()===_.getTime()&&(o.isOvulation=!0)}return o},Y=s=>({"bg-gray-50 text-gray-400":!s.isCurrentMonth,"bg-blue-100":s.isToday,"ring-2 ring-blue-500":s.isSelected,"bg-red-200":s.isPeriod&&s.isCurrentMonth,"bg-purple-200":s.isOvulation&&s.isCurrentMonth,"bg-pink-100":s.isFertile&&!s.isOvulation&&s.isCurrentMonth,"hover:bg-gray-100":!s.isSelected,relative:s.isSexDay}),q=()=>{S.value=new Date(M.value,E.value-1,1)},z=()=>{S.value=new Date(M.value,E.value+1,1)},N=s=>{n.value=s,x.value=!1;const e=$.value.find(o=>{const i=f(o.start_date),v=o.end_date?f(o.end_date):i;return s>=i&&s<=v});e?(c.value=e,l.value={start_date:e.start_date.split("T")[0],end_date:e.end_date?e.end_date.split("T")[0]:"",pain_level:e.pain_level,flow_volume:e.flow_volume,notes:e.notes||""}):c.value=null},F=()=>{n.value=null,c.value=null,x.value=!1},H=()=>{n.value&&(l.value={start_date:w(n.value),end_date:"",pain_level:"无",flow_volume:"正常",notes:""},x.value=!0)},A=()=>{x.value=!1},J=async()=>{if(!n.value)return;const s={start_date:w(n.value),pain_level:l.value.pain_level,flow_volume:l.value.flow_volume,notes:l.value.notes};try{await p("/periods","POST",s),u.showToast({message:"新周期已成功记录！",type:"success"}),x.value=!1,await y(),n.value&&N(n.value)}catch(e){const o=e instanceof Error?e.message:String(e);u.showToast({message:`记录失败: ${o}`,type:"error"})}},j=async()=>{if(!n.value)return;const s=w(n.value),e=C.value.includes(s);try{e?(await p(`/sex/${s}`,"DELETE"),u.showToast({message:"已取消记录",type:"success"})):(await p("/sex","POST",{log_date:s}),u.showToast({message:"已记录 ❤️",type:"success"})),await y()}catch(o){const i=o instanceof Error?o.message:String(o);u.showToast({message:`操作失败: ${i}`,type:"error"})}},K=async()=>{if(!c.value)return;const s={start_date:l.value.start_date,end_date:l.value.end_date||null,pain_level:l.value.pain_level,flow_volume:l.value.flow_volume,notes:l.value.notes};try{await p(`/periods/${c.value.id}`,"PUT",s),u.showToast({message:"记录已更新",type:"success"}),await y(),F()}catch(e){const o=e instanceof Error?e.message:String(e);u.showToast({message:`更新失败: ${o}`,type:"error"})}},Q=async()=>{if(c.value&&confirm("您确定要删除这个经期周期记录吗？此操作无法撤销。"))try{await p(`/periods/${c.value.id}`,"DELETE"),u.showToast({message:"记录已删除",type:"success"}),await y(),F()}catch(s){const e=s instanceof Error?s.message:String(s);u.showToast({message:`删除失败: ${e}`,type:"error"})}},y=async()=>{try{const[s,e,o]=await Promise.all([p("/periods","GET"),p("/periods/predict","GET"),p("/sex","GET")]);$.value=s,b.value=e,C.value=o}catch(s){const e=s instanceof Error?s.message:String(s);u.showToast({message:`加载数据失败: ${e}`,type:"error"})}};return se(()=>{y()}),oe(n,s=>{s||(c.value=null,x.value=!1)}),(s,e)=>(r(),a("div",ae,[e[23]||(e[23]=t("div",{class:"inline-block bg-white/80 backdrop-blur-sm px-6 py-3 rounded-xl shadow mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800"},"经期跟踪器")],-1)),t("div",re,[t("div",ie,[t("div",de,[t("button",{onClick:q,class:"px-4 py-2 bg-gray-200 rounded-lg"},"< 上一月"),t("h2",ue,T(M.value)+" 年 "+T(E.value+1)+" 月",1),t("button",{onClick:z,class:"px-4 py-2 bg-gray-200 rounded-lg"},"下一月 >")]),t("div",ce,[(r(),a(R,null,W(B,o=>t("div",{key:o,class:"font-semibold text-sm"},T(o),1)),64)),(r(!0),a(R,null,W(I.value,o=>(r(),a("div",{key:o.date.toISOString(),class:le(["p-2 h-24 border rounded-md flex flex-col justify-start items-center cursor-pointer",Y(o)]),onClick:i=>N(o.date)},[t("span",ge,T(o.date.getDate()),1),t("div",me,[o.isPeriod?(r(),a("div",pe,"经期")):D("",!0),o.isOvulation?(r(),a("div",fe,"排卵期")):D("",!0),o.isFertile&&!o.isOvulation?(r(),a("div",be,"易孕期")):D("",!0),o.isSexDay?(r(),a("div",xe,"❤️")):D("",!0)])],10,ve))),128))])]),n.value?(r(),a("div",we,[t("h3",ye,"记录 "+T(n.value.toLocaleDateString()),1),c.value?(r(),a("div",_e,[t("div",ke,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"开始日期",-1)),m(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=o=>l.value.start_date=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",disabled:""},null,512),[[P,l.value.start_date]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"结束日期 (如果不确定，请留空)",-1)),m(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=o=>l.value.end_date=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[P,l.value.end_date]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"疼痛程度",-1)),m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.pain_level=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[...e[10]||(e[10]=[t("option",null,"无",-1),t("option",null,"轻度",-1),t("option",null,"中度",-1),t("option",null,"重度",-1)])],512),[[L,l.value.pain_level]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"流量",-1)),m(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.flow_volume=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[...e[12]||(e[12]=[t("option",null,"偏少",-1),t("option",null,"正常",-1),t("option",null,"偏多",-1)])],512),[[L,l.value.flow_volume]])])]),t("div",he,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"备注",-1)),m(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.notes=o),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[P,l.value.notes]])]),t("div",{class:"flex space-x-4"},[t("button",{onClick:K,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"更新记录"),t("button",{onClick:Q,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"},"删除周期"),t("button",{onClick:F,class:"px-4 py-2 bg-gray-300 rounded-lg"},"取消")])])):(r(),a("div",De,[t("div",Te,[G.value?(r(),a("button",{key:1,onClick:j,class:"px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500"},"取消记录爱爱")):(r(),a("button",{key:0,onClick:j,class:"px-4 py-2 bg-rose-500 text-white rounded-lg hover:bg-rose-600"},"记录爱爱 ❤️"))]),e[22]||(e[22]=t("hr",{class:"my-6"},null,-1)),x.value?(r(),a("div",Ce,[e[21]||(e[21]=t("h4",{class:"text-md font-semibold mb-3"},"记录新周期详情",-1)),t("div",Me,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"疼痛程度",-1)),m(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.pain_level=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[...e[16]||(e[16]=[t("option",null,"无",-1),t("option",null,"轻度",-1),t("option",null,"中度",-1),t("option",null,"重度",-1)])],512),[[L,l.value.pain_level]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"流量",-1)),m(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.flow_volume=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[...e[18]||(e[18]=[t("option",null,"偏少",-1),t("option",null,"正常",-1),t("option",null,"偏多",-1)])],512),[[L,l.value.flow_volume]])])]),t("div",Ee,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700"},"备注",-1)),m(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.notes=o),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[P,l.value.notes]])]),t("div",{class:"flex space-x-4"},[t("button",{onClick:J,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"},"保存周期"),t("button",{onClick:A,class:"px-4 py-2 bg-gray-300 rounded-lg"},"取消")])])):(r(),a("div",Se,[e[15]||(e[15]=t("p",{class:"mb-4"},"这一天没有记录。您想开始一个新的经期周期吗？",-1)),t("button",{onClick:H,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"},"记录新周期")]))]))])):D("",!0)])]))}}),Ue=ne(Oe,[["__scopeId","data-v-5c500953"]]);export{Ue as default};
