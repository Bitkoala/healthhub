import{d as Z,u as G,r as b,c as E,o as H,n as U,a as r,b as t,e as h,t as i,F as T,g as _,i as L,h as v,v as y,l as j,m as J,p as K,j as k,q as Q,k as d}from"./index-B4Xyix6F.js";import{C as W,p as X,a as ee,b as te,B as se,c as oe,L as le,d as ae}from"./index-crb7WDXK.js";const ne={class:"container mx-auto p-4 md:p-6 max-w-3xl"},re={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md mb-6 border border-white/20"},de={class:"flex items-center justify-between mb-2"},ie={class:"font-semibold text-lg"},ue={class:"grid grid-cols-7 gap-1"},pe={class:"bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-md mb-6 border border-white/20"},be={class:"space-y-4"},me=["value"],ge={class:"mb-6"},ve={class:"inline-block text-xl font-semibold mb-4 bg-white/70 backdrop-blur-sm px-3 py-1 rounded-lg"},ce={key:0,class:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-xl"},ye={class:"space-y-3"},fe={class:"font-semibold"},xe={class:"text-sm text-gray-700"},we={key:0,class:"text-xs text-gray-500 mt-1 pl-1 border-l-2"},he={class:"flex space-x-2"},ke=["onClick"],De=["onClick"],Se={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md mt-6 border border-white/20"},Te={class:"flex flex-col md:flex-row items-center gap-4 mb-4"},_e={class:"h-64"},Ce={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},$e={class:"space-y-4"},Me=["value"],Ee={class:"mt-6 flex justify-end space-x-2"},je=Z({__name:"StoolView",setup(Le){W.register(X,ee,te,se,oe,le);const a=G(),p=b(new Date),D=b([]),f=b(!1),n=b(null),u=b({log_date:new Date().toISOString().split("T")[0],stool_type:null,notes:""}),m=b(""),g=b(""),S=b({labels:[],datasets:[{label:"每日排便次数",backgroundColor:"#4A90E2",borderColor:"#4A90E2",borderRadius:4,data:[]}]}),F=b({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"每日排便次数统计"}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}),C={1:"颗粒状硬球",2:"香肠状，表面凹凸",3:"香肠状，表面有裂痕",4:"香肠或蛇状，光滑柔软",5:"断边光滑的柔软团块",6:"蓬松的糊状、烂便",7:"水样，无固体块"},A=E(()=>{const o=p.value.getFullYear(),e=p.value.getMonth(),s=new Date(o,e,1).getDay(),l=new Date(o,e+1,0).getDate(),w=Array.from({length:l},(M,R)=>R+1);return[...Array.from({length:s===0?6:s-1},()=>null),...w]}),B=E(()=>p.value.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})),I=E(()=>{const o=new Set;for(const e of D.value)e.log_date&&typeof e.log_date=="string"&&o.add(e.log_date.split("T")[0]);return o}),$=o=>o.toISOString().split("T")[0],x=async()=>{if(!m.value||!g.value){a.showToast({message:"请选择开始和结束日期",type:"error"});return}try{const[o,e]=await Promise.all([k(`/stool-logs/summary?startDate=${m.value}&endDate=${g.value}`),k(`/stool-logs?startDate=${m.value}&endDate=${g.value}`)]);N(o),D.value=e,U(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(o){o instanceof Error?a.showToast({message:`加载数据失败: ${o.message}`,type:"error"}):a.showToast({message:"加载数据失败: 未知错误",type:"error"})}},N=o=>{const e=[],s=[],l=new Date(m.value),w=new Date(g.value);for(let c=l;c<=w;c.setDate(c.getDate()+1)){const M=$(new Date(c));e.push(M.slice(5)),s.push(o[M]||0)}S.value={...S.value,labels:e,datasets:[{...S.value.datasets[0],data:s}]}},O=async()=>{try{const o={...u.value,stool_type:u.value.stool_type?Number(u.value.stool_type):null};await k("/stool-logs","POST",o),a.showToast({message:"记录已保存！"}),u.value={log_date:new Date().toISOString().split("T")[0],stool_type:null,notes:""},await x()}catch(o){o instanceof Error?a.showToast({message:`保存失败: ${o.message}`,type:"error"}):a.showToast({message:"保存失败: 未知错误",type:"error"})}},q=o=>{n.value={...o,stool_type:o.stool_type||null,log_date:o.log_date.split("T")[0]},f.value=!0},z=async()=>{if(n.value)try{await k(`/stool-logs/${n.value.id}`,"PUT",n.value),a.showToast({message:"更新成功！"}),f.value=!1,n.value=null,await x()}catch(o){o instanceof Error?a.showToast({message:`更新失败: ${o.message}`,type:"error"}):a.showToast({message:"更新失败: 未知错误",type:"error"})}},Y=async o=>{if(confirm("确定要删除这条记录吗？"))try{await k(`/stool-logs/${o.id}`,"DELETE"),a.showToast({message:"删除成功"}),await x()}catch(e){e instanceof Error?a.showToast({message:`删除失败: ${e.message}`,type:"error"}):a.showToast({message:"删除失败: 未知错误",type:"error"})}},V=o=>{const e=new Date(p.value);e.setMonth(e.getMonth()+o),p.value=e},P=o=>{const e={},s=new Date,l=s.getDate()===o&&s.getMonth()===p.value.getMonth()&&s.getFullYear()===p.value.getFullYear(),w=`${p.value.getFullYear()}-${String(p.value.getMonth()+1).padStart(2,"0")}-${String(o).padStart(2,"0")}`,c=I.value.has(w);return l&&(e["bg-blue-100"]=!0,e["text-blue-600"]=!0,e["font-bold"]=!0),c&&(e["bg-red-200"]=!0,e["text-red-700"]=!0,e["font-semibold"]=!0),e};return H(()=>{const o=new Date,e=new Date;e.setDate(o.getDate()-6),m.value=$(e),g.value=$(o),x(),U(()=>{typeof lucide<"u"&&lucide.createIcons()})}),(o,e)=>(d(),r("div",ne,[e[32]||(e[32]=t("header",{class:"mb-6"},[t("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[t("h1",{class:"text-2xl font-bold"},"排便记录"),t("p",{class:"text-gray-500 mt-1"},"记录您的每日健康状况")])],-1)),t("div",re,[t("div",de,[t("button",{onClick:e[0]||(e[0]=s=>V(-1)),class:"p-2 rounded-full hover:bg-gray-200"},[...e[12]||(e[12]=[t("i",{"data-lucide":"chevron-left"},null,-1)])]),t("h3",ie,i(B.value),1),t("button",{onClick:e[1]||(e[1]=s=>V(1)),class:"p-2 rounded-full hover:bg-gray-200"},[...e[13]||(e[13]=[t("i",{"data-lucide":"chevron-right"},null,-1)])])]),e[14]||(e[14]=t("div",{class:"grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2"},[t("span",null,"一"),t("span",null,"二"),t("span",null,"三"),t("span",null,"四"),t("span",null,"五"),t("span",null,"六"),t("span",null,"日")],-1)),t("div",ue,[(d(!0),r(T,null,_(A.value,(s,l)=>(d(),r("div",{key:l,class:"h-9 flex items-center justify-center"},[s?(d(),r("div",{key:0,class:Q(["w-8 h-8 flex items-center justify-center rounded-full relative transition-colors",P(s)])},i(s),3)):h("",!0)]))),128))])]),t("div",pe,[e[20]||(e[20]=t("h2",{class:"text-xl font-semibold mb-4"},"添加记录",-1)),t("form",{onSubmit:L(O,["prevent"])},[t("div",be,[t("div",null,[e[15]||(e[15]=t("label",{for:"stool-date-add",class:"block text-sm font-medium text-gray-700"},"日期",-1)),v(t("input",{type:"date",id:"stool-date-add","onUpdate:modelValue":e[2]||(e[2]=s=>u.value.log_date=s),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},null,512),[[y,u.value.log_date]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"stool-type-add",class:"block text-sm font-medium text-gray-700"},"大便类型 (布里斯托分类法)",-1)),v(t("select",{id:"stool-type-add","onUpdate:modelValue":e[3]||(e[3]=s=>u.value.stool_type=s),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},[e[16]||(e[16]=t("option",{value:null},"不记录类型",-1)),(d(),r(T,null,_(C,(s,l)=>t("option",{key:l,value:l},"类型"+i(l)+": "+i(s),9,me)),64))],512),[[j,u.value.stool_type,void 0,{number:!0}]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"stool-notes-add",class:"block text-sm font-medium text-gray-700"},"备注",-1)),v(t("textarea",{id:"stool-notes-add","onUpdate:modelValue":e[4]||(e[4]=s=>u.value.notes=s),rows:"3",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm",placeholder:"例如：颜色、感觉等..."},null,512),[[y,u.value.notes]])])]),e[19]||(e[19]=t("div",{class:"mt-6 flex justify-end"},[t("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all flex items-center space-x-2"},[t("i",{"data-lucide":"save",class:"w-5 h-5"}),t("span",null,"保存记录")])],-1))],32)]),t("main",ge,[t("h2",ve,"历史记录 ("+i(m.value)+" ~ "+i(g.value)+")",1),D.value.length===0?(d(),r("div",ce,[...e[21]||(e[21]=[t("p",null,"当前日期范围没有记录",-1)])])):h("",!0),t("div",ye,[(d(!0),r(T,null,_(D.value,s=>(d(),r("div",{key:s.id,class:"bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-sm flex justify-between items-start border border-white/20"},[t("div",null,[t("p",fe,i(new Date(s.log_date).toLocaleDateString()),1),t("p",xe,i(s.stool_type?`类型${s.stool_type}: ${C[s.stool_type]}`:"已记录"),1),s.notes?(d(),r("p",we,"备注: "+i(s.notes),1)):h("",!0)]),t("div",he,[t("button",{onClick:l=>q(s),class:"text-blue-500 hover:text-blue-700 p-1"},[...e[22]||(e[22]=[t("i",{"data-lucide":"edit-3",class:"w-4 h-4"},null,-1)])],8,ke),t("button",{onClick:l=>Y(s),class:"text-xs bg-red-100 text-red-600 hover:bg-red-200 rounded-full px-2 py-1 font-semibold transition-colors"},"删除",8,De)])]))),128))])]),t("div",Se,[e[25]||(e[25]=t("h2",{class:"text-xl font-semibold mb-4"},"数据分析",-1)),t("div",Te,[t("div",null,[e[23]||(e[23]=t("label",{for:"start-date",class:"text-sm font-medium text-gray-700"},"开始日期",-1)),v(t("input",{type:"date",id:"start-date","onUpdate:modelValue":e[5]||(e[5]=s=>m.value=s),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},null,512),[[y,m.value]])]),t("div",null,[e[24]||(e[24]=t("label",{for:"end-date",class:"text-sm font-medium text-gray-700"},"结束日期",-1)),v(t("input",{type:"date",id:"end-date","onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},null,512),[[y,g.value]])]),t("button",{onClick:x,class:"self-end bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all"}," 查询 ")]),t("div",_e,[J(K(ae),{data:S.value,options:F.value},null,8,["data","options"])])]),f.value?(d(),r("div",{key:0,onClick:e[11]||(e[11]=L(s=>f.value=!1,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[t("div",Ce,[e[31]||(e[31]=t("h2",{class:"text-xl font-bold mb-4"},"编辑记录",-1)),n.value?(d(),r("form",{key:0,onSubmit:L(z,["prevent"])},[t("div",$e,[t("div",null,[e[26]||(e[26]=t("label",{for:"stool-date-edit",class:"block text-sm font-medium text-gray-700"},"日期",-1)),v(t("input",{type:"date",id:"stool-date-edit","onUpdate:modelValue":e[7]||(e[7]=s=>n.value.log_date=s),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},null,512),[[y,n.value.log_date]])]),t("div",null,[e[28]||(e[28]=t("label",{for:"stool-type-edit",class:"block text-sm font-medium text-gray-700"},"大便类型",-1)),v(t("select",{id:"stool-type-edit","onUpdate:modelValue":e[8]||(e[8]=s=>n.value.stool_type=s),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},[e[27]||(e[27]=t("option",{value:null},"不记录类型",-1)),(d(),r(T,null,_(C,(s,l)=>t("option",{key:l,value:l},"类型"+i(l)+": "+i(s),9,Me)),64))],512),[[j,n.value.stool_type,void 0,{number:!0}]])]),t("div",null,[e[29]||(e[29]=t("label",{for:"stool-notes-edit",class:"block text-sm font-medium text-gray-700"},"备注",-1)),v(t("textarea",{id:"stool-notes-edit","onUpdate:modelValue":e[9]||(e[9]=s=>n.value.notes=s),rows:"3",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"},null,512),[[y,n.value.notes]])])]),t("div",Ee,[t("button",{type:"button",onClick:e[10]||(e[10]=s=>f.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg"},"取消"),e[30]||(e[30]=t("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg"},"保存更改",-1))])],32)):h("",!0)])])):h("",!0)]))}});export{je as default};
