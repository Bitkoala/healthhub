import{d as N,a as i,u as R,c as E,o as K,w as O,b as a,e as s,f as n,t as c,k as z,i as _,v as A,l as H,F as v,h as D,m as Q,n as p,x as L,g as P,q as l,p as G}from"./index-DcsSUklf.js";const J={class:"container mx-auto p-4 md:p-6 max-w-4xl mobile-px-0"},W={class:"space-y-6"},X={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},Y={class:"flex justify-between items-center"},Z={key:0,class:"mt-4 border-t pt-4"},ee={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},te={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4"},se={key:0},oe={class:"space-y-2"},ae={class:"flex items-center gap-2"},le=["onClick"],ne=["onClick"],re=["onClick"],ie=["onClick"],de={key:1,class:"mt-4"},ue={class:"space-y-2"},ce={class:"flex items-center gap-2"},me={key:0,class:"text-sm font-semibold text-green-600"},pe=["onClick"],ye=["onClick"],ge={key:2,class:"text-center py-8 text-gray-500"},xe={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},be={class:"flex gap-2"},ve={key:0,class:"text-center py-4"},he={key:1,class:"mt-4 space-y-2"},fe={class:"font-semibold"},we={key:0,class:"text-xs text-gray-500 mt-1 pl-2 border-l-2"},_e={key:2,class:"mt-4 text-center text-gray-500"},$e=N({__name:"DailyView",setup(ke){const k=i(!0),m=i(!1),d=i([]),g=i({}),y=i(new Date().toISOString().split("T")[0]),x=i(""),T=i("daily"),h=i(""),b=i([]),f=i(!1),V=i(!1),r=R(),$=E(()=>(Array.isArray(d.value)?d.value:[]).filter(o=>o.item_type==="daily")),C=E(()=>(Array.isArray(d.value)?d.value:[]).filter(o=>o.item_type==="one-time")),U=async()=>{k.value=!0;try{await Promise.all([q(),S(y.value)])}catch(o){r.showToast({message:`加载初始数据失败: ${o.message}`,type:"error"})}finally{k.value=!1}},q=async()=>{try{const o=await p("/daily-logs/items");d.value=Array.isArray(o)?o:[]}catch(o){r.showToast({message:`获取清单项目失败: ${o.message}`,type:"error"}),d.value=[]}},S=async o=>{try{const e=await p(`/daily-logs/logs/${o}`);g.value=(Array.isArray(e)?e:[]).reduce((t,u)=>(t[u.item_name]=u,t),{})}catch(e){r.showToast({message:`获取当日记录失败: ${e.message}`,type:"error"}),g.value={}}},w=o=>g.value[o]?.status||"pending",I=async(o,e)=>{const t={log_date:y.value,item_name:o,status:e,notes:g.value[o]?.notes||""};try{await p("/daily-logs/logs","POST",t),await S(y.value)}catch(u){r.showToast({message:`更新状态失败: ${u.message}`,type:"error"})}},B=async o=>{try{await p(`/daily-logs/items/${o.id}/complete`,"PUT"),r.showToast({message:`任务 "${o.item_name}" 已完成!`,type:"success"});const e=d.value.findIndex(t=>t.id===o.id);e!==-1&&(d.value[e].status="completed")}catch(e){r.showToast({message:`操作失败: ${e.message}`,type:"error"})}},F=async()=>{if(!x.value.trim()){r.showToast({message:"任务名称不能为空",type:"error"});return}try{const o={item_name:x.value.trim(),item_type:T.value},e=await p("/daily-logs/items","POST",o);d.value.push(e),x.value="",r.showToast({message:"新任务已添加",type:"success"})}catch(o){r.showToast({message:`添加失败: ${o.message}`,type:"error"})}},M=async o=>{if(confirm(`确定要删除任务 "${o.item_name}" 吗？
这将同时删除所有相关的历史记录。`))try{await p(`/daily-logs/items/${o.id}`,"DELETE"),await U(),r.showToast({message:"任务已删除",type:"success"})}catch(e){r.showToast({message:`删除失败: ${e.message}`,type:"error"})}},j=async()=>{if(h.value.trim()){f.value=!0,V.value=!0;try{const o=await p(`/daily-logs/history/search?q=${encodeURIComponent(h.value.trim())}`);b.value=Array.isArray(o)?o:[]}catch(o){r.showToast({message:`搜索失败: ${o.message}`,type:"error"}),b.value=[]}finally{f.value=!1}}};return K(()=>{U()}),O(y,o=>{S(o)}),O([m,d,g],()=>{G(()=>{typeof lucide<"u"&&lucide.createIcons()})},{deep:!0}),(o,e)=>(l(),a("div",J,[e[15]||(e[15]=s("header",{class:"mb-6"},[s("div",{class:"inline-block bg-white/80 backdrop-blur-sm rounded-xl px-4 py-3 md:p-4 shadow border border-white/20"},[s("h1",{class:"text-xl md:text-2xl font-bold"},"每日清单"),s("p",{class:"text-xs md:text-gray-500 mt-1"},"追踪您的每日习惯与任务")])],-1)),s("main",W,[s("div",X,[s("div",Y,[e[5]||(e[5]=s("h2",{class:"text-lg md:text-xl font-semibold"},"任务管理",-1)),s("button",{onClick:e[0]||(e[0]=t=>m.value=!m.value),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-1.5 md:py-2 px-3 md:px-4 rounded-lg transition-all text-xs md:text-sm"},c(m.value?"完成":"添加 / 管理"),1)]),m.value?(l(),a("div",Z,[s("form",{onSubmit:z(F,["prevent"]),class:"flex flex-col sm:flex-row gap-2 mb-4"},[_(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),type:"text",placeholder:"输入新任务名称...",class:"flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[A,x.value]]),_(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>T.value=t),class:"px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[...e[6]||(e[6]=[s("option",{value:"daily"},"每日任务",-1),s("option",{value:"one-time"},"一次性任务",-1)])],512),[[H,T.value]]),e[7]||(e[7]=s("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all"}," 添加 ",-1))],32)])):n("",!0)]),s("div",ee,[s("div",te,[e[8]||(e[8]=s("h2",{class:"text-xl font-semibold"},"今日任务",-1)),_(s("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),class:"px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[A,y.value]])]),$.value.length>0?(l(),a("div",se,[e[9]||(e[9]=s("h3",{class:"text-lg font-semibold mb-2 text-gray-700"},"每日任务",-1)),s("ul",oe,[(l(!0),a(v,null,D($.value,t=>(l(),a("li",{key:t.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},[s("span",null,c(t.item_name),1),s("div",ae,[w(t.item_name)==="pending"?(l(),a(v,{key:0},[s("button",{onClick:u=>I(t.item_name,"completed"),class:"text-xs bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 完成 ",8,le),s("button",{onClick:u=>I(t.item_name,"skipped"),class:"text-xs bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 跳过 ",8,ne)],64)):n("",!0),w(t.item_name)!=="pending"?(l(),a(v,{key:1},[s("span",{class:L([w(t.item_name)==="completed"?"text-green-600":"text-yellow-600","text-sm font-semibold"])},c(w(t.item_name)==="completed"?"今日已完成":"今日已跳过"),3),s("button",{onClick:u=>I(t.item_name,"pending"),class:"text-xs text-gray-500 hover:text-gray-700"}," 撤销 ",8,re)],64)):n("",!0),m.value?(l(),a("button",{key:2,onClick:u=>M(t),class:"text-xs bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-2 rounded-full transition-all"}," 删除 ",8,ie)):n("",!0)])]))),128))])])):n("",!0),C.value.length>0?(l(),a("div",de,[e[10]||(e[10]=s("h3",{class:"text-lg font-semibold mb-2 text-gray-700"},"一次性任务",-1)),s("ul",ue,[(l(!0),a(v,null,D(C.value,t=>(l(),a("li",{key:t.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},[s("span",{class:L({"line-through text-gray-400":t.status==="completed"})},c(t.item_name),3),s("div",ce,[t.status==="completed"?(l(),a("span",me,"已完成")):n("",!0),t.status!=="completed"?(l(),a("button",{key:1,onClick:u=>B(t),class:"text-xs bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 完成 ",8,pe)):n("",!0),m.value?(l(),a("button",{key:2,onClick:u=>M(t),class:"text-xs bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-2 rounded-full transition-all"}," 删除 ",8,ye)):n("",!0)])]))),128))])])):n("",!0),!k.value&&$.value.length===0&&C.value.length===0?(l(),a("div",ge,[...e[11]||(e[11]=[s("p",null,"暂无任务项目。",-1),s("p",null,'点击 "添加 / 管理" 来创建您的第一个任务吧！',-1)])])):n("",!0)]),s("div",xe,[e[14]||(e[14]=s("h2",{class:"text-xl font-semibold mb-4"},"历史记录查询",-1)),s("div",be,[_(s("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>h.value=t),onKeyup:Q(j,["enter"]),placeholder:"输入关键词搜索历史...",class:"flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,544),[[A,h.value]]),s("button",{onClick:j,class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-all"}," 搜索 ")]),f.value?(l(),a("div",ve,"正在搜索...")):n("",!0),b.value.length>0?(l(),a("ul",he,[(l(!0),a(v,null,D(b.value,t=>(l(),a("li",{key:t.id,class:"p-3 bg-gray-50 rounded-lg text-sm"},[s("span",fe,c(new Date(t.log_date).toLocaleDateString()),1),e[12]||(e[12]=P(" - ",-1)),s("span",null,c(t.item_name),1),e[13]||(e[13]=P(": ",-1)),s("span",{class:L(["font-medium",t.status==="completed"?"text-green-600":"text-yellow-600"])},c(t.status==="completed"?"已完成":"已跳过"),3),t.notes?(l(),a("p",we,c(t.notes),1)):n("",!0)]))),128))])):n("",!0),!f.value&&b.value.length===0&&V.value?(l(),a("p",_e," 未找到相关记录。 ")):n("",!0)])])]))}});export{$e as default};
