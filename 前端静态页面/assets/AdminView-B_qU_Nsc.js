import{d as k,Y as T,u as C,r as _,o as D,a as c,b as t,e as h,t as s,q as y,F as E,g as M,h as S,v as L,j as p,k as m,_ as N}from"./index-W5ZrQctR.js";const P={class:"admin-panel p-4 sm:p-6"},U={class:"text-2xl sm:text-3xl font-bold mb-6 text-gray-800"},V={class:"mb-6 border-b border-gray-200"},B={class:"-mb-px flex space-x-6","aria-label":"Tabs"},F={key:0},q={class:"bg-white shadow-md rounded-lg overflow-hidden"},z={class:"p-4"},A={class:"text-xl font-semibold text-gray-700"},H={class:"text-sm text-gray-500 mt-1"},O={class:"overflow-x-auto"},R={class:"min-w-full divide-y divide-gray-200"},j={class:"bg-gray-50"},Y={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},G={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},I={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},J={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},K={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Q={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},W={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},X={class:"bg-white divide-y divide-gray-200"},Z={key:0},ee={colspan:"7",class:"text-center py-4"},te={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},re={class:"px-6 py-4 whitespace-nowrap"},ie={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},de=["onClick"],le=["onClick","disabled"],ce={key:1},me={class:"bg-white shadow-md rounded-lg p-6"},_e={class:"text-xl font-semibold text-gray-700 mb-4"},pe=["innerHTML"],ue={class:"flex items-center space-x-4"},ge={for:"cleanup-days",class:"text-sm font-medium text-gray-700"},he=["placeholder"],ye={for:"cleanup-days",class:"text-sm font-medium text-gray-700"},xe=["disabled"],fe=k({__name:"AdminView",setup(we){const n=T().t,r=C(),l=_("userManagement"),x=_([]),u=_(!0),i=_(90),g=async()=>{u.value=!0;try{const e=await p("/admin/users");x.value=e}catch(e){const a=e instanceof Error?e.message:String(e);r.showToast({message:n("admin_toast_fetch_users_error",{message:a}),type:"error"})}finally{u.value=!1}},w=async e=>{if(confirm(n("admin_confirm_reset_password",{userId:e})))try{const a=await p("/admin/reset-password","POST",{userId:e});alert(n("admin_alert_reset_password_success",{userId:e,newPassword:a.newPassword})),r.showToast({message:a.message,type:"success"})}catch(a){const o=a instanceof Error?a.message:String(a);r.showToast({message:n("admin_toast_reset_password_error",{message:o}),type:"error"})}},b=async(e,a)=>{const o=a||`ID: ${e}`;if(confirm(n("admin_confirm_delete_user",{username:o})))try{const d=await p(`/admin/delete-user/${e}`,"DELETE");r.showToast({message:d.message,type:"success"}),g()}catch(d){const $=d instanceof Error?d.message:String(d);r.showToast({message:n("admin_toast_delete_user_error",{message:$}),type:"error"})}},v=async()=>{if(!i.value||i.value<=0){r.showToast({message:n("admin_toast_invalid_days"),type:"error"});return}if(confirm(n("admin_confirm_cleanup",{days:i.value})))try{const e=await p("/admin/cleanup-inactive-users","POST",{days:i.value});r.showToast({message:n("admin_toast_cleanup_success",{message:e.message,count:e.cleanedUserIds.length}),type:"success"}),g()}catch(e){const a=e instanceof Error?e.message:String(e);r.showToast({message:n("admin_toast_cleanup_error",{message:a}),type:"error"})}},f=e=>{if(!e)return null;try{const a=new Date(e);return isNaN(a.getTime())?e:a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return console.error(`Failed to format date: ${e}`,a),e}};return D(()=>{g()}),(e,a)=>(m(),c("div",P,[t("h1",U,s(e.$t("admin_title")),1),t("div",V,[t("nav",B,[t("button",{onClick:a[0]||(a[0]=o=>l.value="userManagement"),class:y(["px-3 py-2 font-medium text-sm rounded-t-md",l.value==="userManagement"?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"])},s(e.$t("admin_user_management")),3),t("button",{onClick:a[1]||(a[1]=o=>l.value="systemTools"),class:y(["px-3 py-2 font-medium text-sm rounded-t-md",l.value==="systemTools"?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"])},s(e.$t("admin_system_tools")),3)])]),l.value==="userManagement"?(m(),c("div",F,[t("div",q,[t("div",z,[t("h2",A,s(e.$t("admin_user_list")),1),t("p",H,s(e.$t("admin_user_list_desc")),1)]),t("div",O,[t("table",R,[t("thead",j,[t("tr",null,[t("th",Y,s(e.$t("admin_user_id")),1),t("th",G,s(e.$t("admin_username")),1),t("th",I,s(e.$t("admin_email")),1),t("th",J,s(e.$t("admin_created_at")),1),t("th",K,s(e.$t("admin_last_login")),1),t("th",Q,s(e.$t("admin_role")),1),t("th",W,s(e.$t("admin_actions")),1)])]),t("tbody",X,[u.value?(m(),c("tr",Z,[t("td",ee,s(e.$t("admin_loading")),1)])):h("",!0),(m(!0),c(E,null,M(x.value,o=>(m(),c("tr",{key:o.id},[t("td",te,s(o.id),1),t("td",se,s(o.username||e.$t("admin_na")),1),t("td",ae,s(o.email||e.$t("admin_na")),1),t("td",oe,s(f(o.created_at)),1),t("td",ne,s(f(o.last_login_at)||e.$t("admin_never")),1),t("td",re,[t("span",{class:y(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",o.is_admin===1?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},s(o.is_admin===1?e.$t("admin_role_admin"):e.$t("admin_role_user")),3)]),t("td",ie,[t("button",{onClick:d=>w(o.id),class:"text-indigo-600 hover:text-indigo-900 mr-3"},s(e.$t("admin_reset_password")),9,de),t("button",{onClick:d=>b(o.id,o.username),class:"text-red-600 hover:text-red-900",disabled:o.is_admin===1},s(o.is_admin===1?e.$t("admin_cannot_delete"):e.$t("admin_delete")),9,le)])]))),128))])])])])])):h("",!0),l.value==="systemTools"?(m(),c("div",ce,[t("div",me,[t("h2",_e,s(e.$t("admin_cleanup_title")),1),t("p",{class:"text-sm text-gray-500 mb-4",innerHTML:e.$t("admin_cleanup_desc")},null,8,pe),t("div",ue,[t("label",ge,s(e.$t("admin_cleanup_prefix")),1),S(t("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=o=>i.value=o),id:"cleanup-days",class:"block w-24 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:e.$t("admin_cleanup_placeholder")},null,8,he),[[L,i.value,void 0,{number:!0}]]),t("label",ye,s(e.$t("admin_cleanup_suffix")),1),t("button",{onClick:v,disabled:!i.value||i.value<=0,class:"px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 disabled:bg-red-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"},s(e.$t("admin_cleanup_button")),9,xe)])])])):h("",!0)]))}}),ve=N(fe,[["__scopeId","data-v-e461c4ea"]]);export{ve as default};
