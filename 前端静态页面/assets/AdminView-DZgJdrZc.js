import{d as k,u as T,r as m,o as $,c as l,a as t,b as u,n as y,F as C,g as D,f as E,v as M,h as p,t as i,j as c}from"./index-BH0FCm0V.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const S={class:"admin-panel p-4 sm:p-6"},V={class:"mb-6 border-b border-gray-200"},A={class:"-mb-px flex space-x-6","aria-label":"Tabs"},P={key:0},U={class:"bg-white shadow-md rounded-lg overflow-hidden"},B={class:"overflow-x-auto"},F={class:"min-w-full divide-y divide-gray-200"},I={class:"bg-white divide-y divide-gray-200"},L={key:0},z={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},O={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},R={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},j={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},q={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},G={class:"px-6 py-4 whitespace-nowrap"},H={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},J=["onClick"],K=["onClick","disabled"],Q={key:1},W={class:"bg-white shadow-md rounded-lg p-6"},X={class:"flex items-center space-x-4"},Y=["disabled"],Z=k({__name:"AdminView",setup(ee){const a=T(),d=m("userManagement"),f=m([]),x=m(!0),r=m(90),g=async()=>{x.value=!0;try{const o=await p("/admin/users");f.value=o}catch(o){const e=o instanceof Error?o.message:String(o);a.showToast({message:"获取用户列表失败: "+e,type:"error"})}finally{x.value=!1}},b=async o=>{if(confirm(`确定要为用户ID ${o} 重置密码吗？新密码将随机生成。`))try{const e=await p("/admin/reset-password","POST",{userId:o});alert(`密码重置成功！
用户ID: ${o}
新密码: ${e.newPassword}`),a.showToast({message:e.message,type:"success"})}catch(e){const s=e instanceof Error?e.message:String(e);a.showToast({message:"重置密码失败: "+s,type:"error"})}},v=async(o,e)=>{const s=`确定要永久删除用户 "${e||"ID: "+o}" 及其所有数据吗？

这是一个不可逆的操作！`;if(confirm(s))try{const n=await p(`/admin/delete-user/${o}`,"DELETE");a.showToast({message:n.message,type:"success"}),g()}catch(n){const _=n instanceof Error?n.message:String(n);a.showToast({message:"删除用户失败: "+_,type:"error"})}},w=async()=>{if(!r.value||r.value<=0){a.showToast({message:"请输入有效的天数。",type:"error"});return}const o=`确定要清理超过 ${r.value} 天未登录的所有非管理员用户吗？

这是一个不可逆的操作！`;if(confirm(o))try{const e=await p("/admin/cleanup-inactive-users","POST",{days:r.value});a.showToast({message:`${e.message} 共清理了 ${e.cleanedUserIds.length} 个用户。`,type:"success"}),g()}catch(e){const s=e instanceof Error?e.message:String(e);a.showToast({message:"清理失败: "+s,type:"error"})}},h=o=>{if(!o)return null;try{const e=new Date(o);return isNaN(e.getTime())?o:e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error(`Failed to format date: ${o}`,e),o}};return $(()=>{g()}),(o,e)=>(c(),l("div",S,[e[10]||(e[10]=t("h1",{class:"text-2xl sm:text-3xl font-bold mb-6 text-gray-800"},"管理面板",-1)),t("div",V,[t("nav",A,[t("button",{onClick:e[0]||(e[0]=s=>d.value="userManagement"),class:y(["px-3 py-2 font-medium text-sm rounded-t-md",d.value==="userManagement"?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," 用户管理 ",2),t("button",{onClick:e[1]||(e[1]=s=>d.value="systemTools"),class:y(["px-3 py-2 font-medium text-sm rounded-t-md",d.value==="systemTools"?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," 系统工具 ",2)])]),d.value==="userManagement"?(c(),l("div",P,[t("div",U,[e[5]||(e[5]=t("div",{class:"p-4"},[t("h2",{class:"text-xl font-semibold text-gray-700"},"用户列表"),t("p",{class:"text-sm text-gray-500 mt-1"},"查看、管理和操作所有用户账户。")],-1)),t("div",B,[t("table",F,[e[4]||(e[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"用户ID"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"用户名"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"邮箱"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"注册时间"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"最后登录"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"角色"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"操作")])],-1)),t("tbody",I,[x.value?(c(),l("tr",L,[...e[3]||(e[3]=[t("td",{colspan:"7",class:"text-center py-4"},"加载中...",-1)])])):u("",!0),(c(!0),l(C,null,D(f.value,s=>(c(),l("tr",{key:s.id},[t("td",z,i(s.id),1),t("td",O,i(s.username||"N/A"),1),t("td",R,i(s.email||"N/A"),1),t("td",j,i(h(s.created_at)),1),t("td",q,i(h(s.last_login_at)||"从未"),1),t("td",G,[t("span",{class:y(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.is_admin===1?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},i(s.is_admin===1?"管理员":"用户"),3)]),t("td",H,[t("button",{onClick:n=>b(s.id),class:"text-indigo-600 hover:text-indigo-900 mr-3"},"重置密码",8,J),t("button",{onClick:n=>v(s.id,s.username),class:"text-red-600 hover:text-red-900",disabled:s.is_admin===1},i(s.is_admin===1?"无法删除":"删除"),9,K)])]))),128))])])])])])):u("",!0),d.value==="systemTools"?(c(),l("div",Q,[t("div",W,[e[8]||(e[8]=t("h2",{class:"text-xl font-semibold text-gray-700 mb-4"},"清理非活跃用户",-1)),e[9]||(e[9]=t("p",{class:"text-sm text-gray-500 mb-4"}," 此工具将永久删除在指定天数内没有登录过的 **非管理员** 用户及其所有关联数据。这是一个不可逆操作，请谨慎使用。 ",-1)),t("div",X,[e[6]||(e[6]=t("label",{for:"cleanup-days",class:"text-sm font-medium text-gray-700"},"清理超过",-1)),E(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=s=>r.value=s),id:"cleanup-days",class:"block w-24 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"例如 90"},null,512),[[M,r.value,void 0,{number:!0}]]),e[7]||(e[7]=t("label",{for:"cleanup-days",class:"text-sm font-medium text-gray-700"},"天未登录的用户",-1)),t("button",{onClick:w,disabled:!r.value||r.value<=0,class:"px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 disabled:bg-red-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," 开始清理 ",8,Y)])])])):u("",!0)]))}}),oe=N(Z,[["__scopeId","data-v-38349ee5"]]);export{oe as default};
