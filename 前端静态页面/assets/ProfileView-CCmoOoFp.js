import{d as E,C as q,z as D,r,w as L,a as p,b as e,t as n,p as c,q as m,e as y,i as _,h as w,v,D as M,j as k,k as f}from"./index-CcnIVy54.js";const B={class:"min-h-screen pt-32 pb-48 px-4 sm:px-6 lg:px-8"},F={class:"max-w-3xl mx-auto space-y-8"},O={class:"animate-fade-in text-center space-y-4 mb-12"},R={class:"inline-block relative"},T={class:"relative text-4xl font-black text-on-surface tracking-tighter sm:text-5xl"},$={class:"text-on-surface-variant font-medium tracking-wide uppercase text-xs opacity-60"},j={class:"glass-card overflow-hidden animate-slide-up",style:{"animation-delay":"0.1s"}},z={class:"p-8 space-y-10"},H={class:"space-y-6"},N={class:"flex items-center justify-between p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-sm transition-all hover:bg-white/10"},W=["aria-checked"],A={class:"space-y-6"},G={class:"space-y-2"},I={class:"relative group"},J={class:"space-y-2"},K={class:"relative group"},Q={class:"md:col-span-2 pt-4"},X=["disabled"],Y={key:0},Z={class:"space-y-6"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se={class:"space-y-2"},te={class:"space-y-2"},ae=["disabled"],oe={key:1,class:"p-6 rounded-2xl bg-amber-500/5 border border-amber-500/10 text-center animate-pulse"},le={class:"pt-8 flex flex-col items-center border-t border-white/10 px-4"},re={class:"text-sm uppercase tracking-[0.2em]"},de=E({__name:"ProfileView",setup(ne){const a=q(),P=M(),o=D({username:a.user?.username||"",email:a.user?.email||""}),x=r(!1),i=r(""),g=r(!1),d=r({oldPassword:"",newPassword:""}),b=r(!1),u=r(""),h=r(!1);L(()=>a.user,t=>{t&&(o.username=t.username||"",o.email=t.email||"")},{immediate:!0});const S=async()=>{x.value=!0,i.value="",g.value=!1;try{const t=await k("/auth/me","PUT",o);a.setUser(t),i.value="个人资料更新成功！"}catch(t){g.value=!0,t instanceof Error?i.value=`更新失败: ${t.message}`:i.value="更新时发生未知错误"}finally{x.value=!1}},C=async()=>{b.value=!0,u.value="",h.value=!1;try{await k("/auth/me/password","PUT",d.value),u.value="密码更新成功！",d.value={oldPassword:"",newPassword:""}}catch(t){h.value=!0,t instanceof Error?u.value=`密码修改失败: ${t.message}`:u.value="修改密码时发生未知错误"}finally{b.value=!1}},U=()=>{a.logout(),P.push({name:"Login"})},V=async()=>{if(a.user)try{const t=!!a.user.show_womens_health;await a.updateShowWomensHealth(!t)}catch(t){console.error("Failed to update setting:",t)}};return(t,s)=>(f(),p("div",B,[e("div",F,[e("div",O,[e("div",R,[s[4]||(s[4]=e("div",{class:"absolute -inset-4 bg-gradient-to-r from-blue-500/20 to-purple-500/20 blur-2xl rounded-full opacity-50"},null,-1)),e("h1",T,n(c(a).user?.username),1)]),e("p",$,n(c(a).user?.email),1)]),e("div",j,[e("div",z,[e("section",H,[s[6]||(s[6]=e("div",{class:"flex items-center space-x-3"},[e("i",{"data-lucide":"settings",class:"w-5 h-5 text-blue-500/60"}),e("h3",{class:"text-sm font-bold uppercase tracking-widest text-on-surface/80"},"应用偏好")],-1)),e("div",N,[s[5]||(s[5]=e("div",{class:"space-y-1"},[e("span",{class:"text-sm font-bold text-on-surface"},"显示女性健康模块"),e("p",{class:"text-[10px] text-on-surface-variant/60 uppercase tracking-wider"},"控制侧边栏和主页是否显示经期与健康追踪")],-1)),e("button",{onClick:V,role:"switch","aria-checked":c(a).user?.show_womens_health,class:m(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none",c(a).user?.show_womens_health?"bg-blue-600":"bg-white/10"])},[e("span",{"aria-hidden":"true",class:m(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-lg ring-0 transition duration-300 ease-in-out",c(a).user?.show_womens_health?"translate-x-5":"translate-x-0"])},null,2)],10,W)])]),s[18]||(s[18]=e("div",{class:"h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),e("section",A,[s[11]||(s[11]=e("div",{class:"flex items-center space-x-3"},[e("i",{"data-lucide":"user",class:"w-5 h-5 text-blue-500/60"}),e("h3",{class:"text-sm font-bold uppercase tracking-widest text-on-surface/80"},"账号资料")],-1)),e("form",{onSubmit:_(S,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",G,[s[8]||(s[8]=e("label",{for:"username",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"用户名",-1)),e("div",I,[s[7]||(s[7]=e("i",{"data-lucide":"at-sign",class:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-on-surface-variant/40 group-focus-within:text-blue-500 transition-colors"},null,-1)),w(e("input",{type:"text",id:"username","onUpdate:modelValue":s[0]||(s[0]=l=>o.username=l),class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 pl-12 pr-4 text-sm text-on-surface placeholder:text-on-surface-variant/20 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/40 transition-all"},null,512),[[v,o.username]])])]),e("div",J,[s[10]||(s[10]=e("label",{for:"email",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"电子邮箱",-1)),e("div",K,[s[9]||(s[9]=e("i",{"data-lucide":"mail",class:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-on-surface-variant/40 group-focus-within:text-blue-500 transition-colors"},null,-1)),w(e("input",{type:"email",id:"email","onUpdate:modelValue":s[1]||(s[1]=l=>o.email=l),class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 pl-12 pr-4 text-sm text-on-surface placeholder:text-on-surface-variant/20 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/40 transition-all"},null,512),[[v,o.email]])])]),e("div",Q,[e("button",{type:"submit",disabled:x.value,class:"w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-2xl shadow-xl shadow-blue-500/20 hover:shadow-blue-500/40 active:scale-[0.98] transition-all disabled:opacity-50 disabled:grayscale"},n(x.value?"同步中...":"提交更改"),9,X)])],32),i.value?(f(),p("p",{key:0,class:m(["text-center text-xs font-bold mt-4",g.value?"text-red-400":"text-emerald-400"])},n(i.value),3)):y("",!0)]),c(a).user?.has_password?(f(),p("div",Y,[s[15]||(s[15]=e("div",{class:"h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent my-10"},null,-1)),e("section",Z,[s[14]||(s[14]=e("div",{class:"flex items-center space-x-3"},[e("i",{"data-lucide":"lock",class:"w-5 h-5 text-amber-500/60"}),e("h3",{class:"text-sm font-bold uppercase tracking-widest text-on-surface/80"},"修改安全密码")],-1)),e("form",{onSubmit:_(C,["prevent"]),class:"space-y-6"},[e("div",ee,[e("div",se,[s[12]||(s[12]=e("label",{for:"oldPassword",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"当前密码",-1)),w(e("input",{type:"password",id:"oldPassword","onUpdate:modelValue":s[2]||(s[2]=l=>d.value.oldPassword=l),required:"",class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 px-4 text-sm text-on-surface focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"},null,512),[[v,d.value.oldPassword]])]),e("div",te,[s[13]||(s[13]=e("label",{for:"newPassword",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"新密码",-1)),w(e("input",{type:"password",id:"newPassword","onUpdate:modelValue":s[3]||(s[3]=l=>d.value.newPassword=l),required:"",class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 px-4 text-sm text-on-surface focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"},null,512),[[v,d.value.newPassword]])])]),e("button",{type:"submit",disabled:b.value,class:"w-full py-4 border border-blue-500/30 text-blue-500 bg-blue-500/5 hover:bg-blue-500/10 font-bold rounded-2xl transition-all active:scale-[0.98]"},n(b.value?"正在验证...":"更新安全凭证"),9,ae)],32),u.value?(f(),p("p",{key:0,class:m(["text-center text-xs font-bold",h.value?"text-red-400":"text-emerald-400"])},n(u.value),3)):y("",!0)])])):(f(),p("div",oe,[...s[16]||(s[16]=[e("p",{class:"text-xs text-amber-500 font-bold uppercase tracking-widest"}," 您当前使用 CASDOOR SSO 登录，安全管控由中心化身份服务器处理。 ",-1)])])),e("div",le,[e("button",{onClick:U,class:"group flex items-center space-x-3 text-red-500/60 hover:text-red-500 font-bold transition-all"},[s[17]||(s[17]=e("i",{"data-lucide":"log-out",class:"w-5 h-5 group-hover:-translate-x-1 transition-transform"},null,-1)),e("span",re,n(t.$t("logout")),1)])])])])])]))}});export{de as default};
