import{d as E,C as q,z as L,r as a,w as M,a as g,b as e,t as u,p as m,q as c,e as h,i as k,h as b,v,D as j,j as P,k as f}from"./index-Dl9U5HsD.js";const B={class:"min-h-screen bg-gray-100 flex items-center justify-center p-4 sm:p-6 lg:p-8"},D={class:"max-w-md md:max-w-2xl w-full bg-white rounded-xl shadow-md overflow-hidden"},F={class:"p-8"},T={class:"text-center"},z={class:"mt-4 text-2xl font-bold text-gray-900"},H={class:"mt-1 text-md text-gray-500"},N={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},R=["aria-checked"],W=["disabled"],$={key:0},A=["disabled"],G={key:1,class:"mt-6 p-4 bg-gray-100 rounded-lg"},K=E({__name:"ProfileView",setup(I){const o=q(),_=j(),l=L({username:o.user?.username||"",email:o.user?.email||""}),w=a(!1),n=a(""),x=a(!1),d=a({oldPassword:"",newPassword:""}),p=a(!1),i=a(""),y=a(!1);M(()=>o.user,t=>{t&&(l.username=t.username||"",l.email=t.email||"")},{immediate:!0});const S=async()=>{w.value=!0,n.value="",x.value=!1;try{const t=await P("/me","PUT",l);o.setUser(t),n.value="个人资料更新成功！"}catch(t){x.value=!0,t instanceof Error?n.value=`更新失败: ${t.message}`:n.value="更新时发生未知错误"}finally{w.value=!1}},U=async()=>{p.value=!0,i.value="",y.value=!1;try{await P("/me/password","PUT",d.value),i.value="密码更新成功！",d.value={oldPassword:"",newPassword:""}}catch(t){y.value=!0,t instanceof Error?i.value=`密码修改失败: ${t.message}`:i.value="修改密码时发生未知错误"}finally{p.value=!1}},V=()=>{o.logout(),_.push({name:"Login"})},C=async()=>{if(o.user)try{const t=!!o.user.show_womens_health;await o.updateShowWomensHealth(!t)}catch(t){console.error("Failed to update setting:",t)}};return(t,s)=>(f(),g("div",B,[e("div",D,[e("div",F,[e("div",T,[e("h2",z,u(m(o).user?.username),1),e("p",H,u(m(o).user?.email),1)]),s[13]||(s[13]=e("hr",{class:"my-6"},null,-1)),e("div",null,[s[5]||(s[5]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"应用设置",-1)),e("div",N,[s[4]||(s[4]=e("span",{class:"text-sm font-medium text-gray-700"},"显示女性健康模块",-1)),e("button",{onClick:C,role:"switch","aria-checked":m(o).user?.show_womens_health,class:c(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",m(o).user?.show_womens_health?"bg-green-600":"bg-gray-300"])},[e("span",{"aria-hidden":"true",class:c(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",m(o).user?.show_womens_health?"translate-x-5":"translate-x-0"])},null,2)],10,R)])]),s[14]||(s[14]=e("hr",{class:"my-6"},null,-1)),e("div",null,[s[8]||(s[8]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"更新个人资料",-1)),e("form",{onSubmit:k(S,["prevent"]),class:"space-y-4"},[e("div",null,[s[6]||(s[6]=e("label",{for:"username",class:"block text-sm font-medium text-gray-700"},"用户名",-1)),b(e("input",{type:"text",id:"username","onUpdate:modelValue":s[0]||(s[0]=r=>l.username=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[v,l.username]])]),e("div",null,[s[7]||(s[7]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"邮箱",-1)),b(e("input",{type:"email",id:"email","onUpdate:modelValue":s[1]||(s[1]=r=>l.email=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[v,l.email]])]),e("button",{type:"submit",disabled:w.value,class:"w-full px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:bg-gray-400"},u(w.value?"正在保存...":"保存资料"),9,W)],32),n.value?(f(),g("p",{key:0,class:c(["mt-2 text-sm",x.value?"text-red-600":"text-green-600"])},u(n.value),3)):h("",!0)]),s[15]||(s[15]=e("hr",{class:"my-6"},null,-1)),m(o).user?.has_password?(f(),g("div",$,[s[11]||(s[11]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"修改密码",-1)),e("form",{onSubmit:k(U,["prevent"]),class:"space-y-4"},[e("div",null,[s[9]||(s[9]=e("label",{for:"oldPassword",class:"block text-sm font-medium text-gray-700"},"旧密码",-1)),b(e("input",{type:"password",id:"oldPassword","onUpdate:modelValue":s[2]||(s[2]=r=>d.value.oldPassword=r),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[v,d.value.oldPassword]])]),e("div",null,[s[10]||(s[10]=e("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700"},"新密码 (至少6位)",-1)),b(e("input",{type:"password",id:"newPassword","onUpdate:modelValue":s[3]||(s[3]=r=>d.value.newPassword=r),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[v,d.value.newPassword]])]),e("button",{type:"submit",disabled:p.value,class:"w-full px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-400"},u(p.value?"正在提交...":"确认修改"),9,A)],32),i.value?(f(),g("p",{key:0,class:c(["mt-2 text-sm",y.value?"text-red-600":"text-green-600"])},u(i.value),3)):h("",!0)])):(f(),g("div",G,[...s[12]||(s[12]=[e("p",{class:"text-sm text-gray-700"},"您通过第三方服务登录，无需设置或更改密码。",-1)])])),e("div",{class:"mt-8"},[e("button",{onClick:V,class:"w-full px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700"}," 退出登录 ")])])])]))}});export{K as default};
