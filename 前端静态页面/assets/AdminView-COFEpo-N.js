import{d as U,Y as V,u as L,r as _,o as N,a as d,b as t,e as p,t as s,q as y,F as P,g as B,h as b,v,j as g,k as l,_ as F}from"./index-qRa6JHGK.js";const O={class:"admin-panel p-4 sm:p-6"},j={class:"text-2xl sm:text-3xl font-bold mb-6 text-gray-800"},q={class:"mb-6 border-b border-gray-200"},z={class:"-mb-px flex space-x-6","aria-label":"Tabs"},A={key:0},H={class:"bg-white shadow-md rounded-lg overflow-hidden"},R={class:"p-4"},Y={class:"text-xl font-semibold text-gray-700"},G={class:"text-sm text-gray-500 mt-1"},I={class:"overflow-x-auto"},J={class:"min-w-full divide-y divide-gray-200"},K={class:"bg-gray-50"},Q={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},W={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},X={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Z={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ee={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},te={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},se={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ae={class:"bg-white divide-y divide-gray-200"},oe={key:0},ne={colspan:"7",class:"text-center py-4"},re={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},me={class:"px-6 py-4 whitespace-nowrap"},ue={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},pe=["onClick"],_e=["onClick","disabled"],ge={key:1},he={class:"bg-white shadow-md rounded-lg p-6"},ye={class:"text-xl font-semibold text-gray-700 mb-4"},xe=["innerHTML"],fe={class:"flex items-center space-x-4"},be={for:"cleanup-days",class:"text-sm font-medium text-gray-700"},ve=["placeholder"],we={for:"cleanup-days",class:"text-sm font-medium text-gray-700"},$e=["disabled"],ke={key:2},Ce={class:"bg-white shadow-md rounded-lg p-6 max-w-2xl"},Te={class:"text-xl font-semibold text-gray-700 mb-4"},Se={class:"space-y-6"},Ee={class:"block text-sm font-medium text-gray-700 mb-2"},De=["placeholder"],Me={class:"block text-sm font-medium text-gray-700 mb-2"},Ue=["placeholder"],Ve={key:0,class:"p-4 bg-gray-50 rounded-xl border border-dashed border-gray-300"},Le={class:"text-xs text-gray-400 mb-2 uppercase"},Ne={class:"flex flex-col items-center justify-center space-y-4 py-4"},Pe=["src"],Be={key:1,class:"text-blue-600 font-bold text-lg text-center"},Fe={class:"flex space-x-4 pt-4 border-t border-gray-100"},Oe=["disabled"],je=U({__name:"AdminView",setup(qe){const r=V().t,i=L(),c=_("userManagement"),w=_([]),x=_(!0),m=_(90),h=_(!1),n=_({image:"",text:""}),f=async()=>{x.value=!0;try{const e=await g("/admin/users");w.value=e}catch(e){const a=e instanceof Error?e.message:String(e);i.showToast({message:r("admin_toast_fetch_users_error",{message:a}),type:"error"})}finally{x.value=!1}},k=async e=>{if(confirm(r("admin_confirm_reset_password",{userId:e})))try{const a=await g("/admin/reset-password","POST",{userId:e});alert(r("admin_alert_reset_password_success",{userId:e,newPassword:a.newPassword})),i.showToast({message:a.message,type:"success"})}catch(a){const o=a instanceof Error?a.message:String(a);i.showToast({message:r("admin_toast_reset_password_error",{message:o}),type:"error"})}},C=async(e,a)=>{const o=a||`ID: ${e}`;if(confirm(r("admin_confirm_delete_user",{username:o})))try{const u=await g(`/admin/delete-user/${e}`,"DELETE");i.showToast({message:u.message,type:"success"}),f()}catch(u){const M=u instanceof Error?u.message:String(u);i.showToast({message:r("admin_toast_delete_user_error",{message:M}),type:"error"})}},T=async()=>{if(!m.value||m.value<=0){i.showToast({message:r("admin_toast_invalid_days"),type:"error"});return}if(confirm(r("admin_confirm_cleanup",{days:m.value})))try{const e=await g("/admin/cleanup-inactive-users","POST",{days:m.value});i.showToast({message:r("admin_toast_cleanup_success",{message:e.message,count:e.cleanedUserIds.length}),type:"success"}),f()}catch(e){const a=e instanceof Error?e.message:String(e);i.showToast({message:r("admin_toast_cleanup_error",{message:a}),type:"error"})}},S=async()=>{try{const e=await g("/public/config/app_splash_config");e&&e.value&&(n.value=e.value)}catch{console.warn("No existing splash config found or fetch failed")}},E=async()=>{h.value=!0;try{await g("/admin/config","POST",{key:"app_splash_config",value:n.value}),i.showToast({message:r("admin_toast_save_config_success"),type:"success"})}catch(e){const a=e instanceof Error?e.message:String(e);i.showToast({message:r("admin_toast_save_config_error",{message:a}),type:"error"})}finally{h.value=!1}},D=()=>{n.value={image:"",text:""}},$=e=>{if(!e)return null;try{const a=new Date(e);return isNaN(a.getTime())?e:a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return console.error(`Failed to format date: ${e}`,a),e}};return N(()=>{f(),S()}),(e,a)=>(l(),d("div",O,[t("h1",j,s(e.$t("admin_title")),1),t("div",q,[t("nav",z,[t("button",{onClick:a[0]||(a[0]=o=>c.value="userManagement"),class:y(["px-3 py-2 font-medium text-sm rounded-t-md",c.value==="userManagement"?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"])},s(e.$t("admin_user_management")),3),t("button",{onClick:a[1]||(a[1]=o=>c.value="systemTools"),class:y(["px-3 py-2 font-medium text-sm rounded-t-md",c.value==="systemTools"?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"])},s(e.$t("admin_system_tools")),3),t("button",{onClick:a[2]||(a[2]=o=>c.value="brandingConfig"),class:y(["px-3 py-2 font-medium text-sm rounded-t-md",c.value==="brandingConfig"?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"])},s(e.$t("admin_branding")),3)])]),c.value==="userManagement"?(l(),d("div",A,[t("div",H,[t("div",R,[t("h2",Y,s(e.$t("admin_user_list")),1),t("p",G,s(e.$t("admin_user_list_desc")),1)]),t("div",I,[t("table",J,[t("thead",K,[t("tr",null,[t("th",Q,s(e.$t("admin_user_id")),1),t("th",W,s(e.$t("admin_username")),1),t("th",X,s(e.$t("admin_email")),1),t("th",Z,s(e.$t("admin_created_at")),1),t("th",ee,s(e.$t("admin_last_login")),1),t("th",te,s(e.$t("admin_role")),1),t("th",se,s(e.$t("admin_actions")),1)])]),t("tbody",ae,[x.value?(l(),d("tr",oe,[t("td",ne,s(e.$t("admin_loading")),1)])):p("",!0),(l(!0),d(P,null,B(w.value,o=>(l(),d("tr",{key:o.id},[t("td",re,s(o.id),1),t("td",ie,s(o.username||e.$t("admin_na")),1),t("td",de,s(o.email||e.$t("admin_na")),1),t("td",le,s($(o.created_at)),1),t("td",ce,s($(o.last_login_at)||e.$t("admin_never")),1),t("td",me,[t("span",{class:y(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",o.is_admin===1?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},s(o.is_admin===1?e.$t("admin_role_admin"):e.$t("admin_role_user")),3)]),t("td",ue,[t("button",{onClick:u=>k(o.id),class:"text-indigo-600 hover:text-indigo-900 mr-3"},s(e.$t("admin_reset_password")),9,pe),t("button",{onClick:u=>C(o.id,o.username),class:"text-red-600 hover:text-red-900",disabled:o.is_admin===1},s(o.is_admin===1?e.$t("admin_cannot_delete"):e.$t("admin_delete")),9,_e)])]))),128))])])])])])):p("",!0),c.value==="systemTools"?(l(),d("div",ge,[t("div",he,[t("h2",ye,s(e.$t("admin_cleanup_title")),1),t("p",{class:"text-sm text-gray-500 mb-4",innerHTML:e.$t("admin_cleanup_desc")},null,8,xe),t("div",fe,[t("label",be,s(e.$t("admin_cleanup_prefix")),1),b(t("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=o=>m.value=o),id:"cleanup-days",class:"block w-24 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white text-gray-900",placeholder:e.$t("admin_cleanup_placeholder")},null,8,ve),[[v,m.value,void 0,{number:!0}]]),t("label",we,s(e.$t("admin_cleanup_suffix")),1),t("button",{onClick:T,disabled:!m.value||m.value<=0,class:"px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 disabled:bg-red-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"},s(e.$t("admin_cleanup_button")),9,$e)])])])):p("",!0),c.value==="brandingConfig"?(l(),d("div",ke,[t("div",Ce,[t("h2",Te,s(e.$t("admin_splash_config")),1),t("div",Se,[t("div",null,[t("label",Ee,s(e.$t("admin_splash_image_url")),1),b(t("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=o=>n.value.image=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 bg-gray-50 text-gray-800",placeholder:e.$t("admin_splash_placeholder_image")},null,8,De),[[v,n.value.image]])]),t("div",null,[t("label",Me,s(e.$t("admin_splash_text")),1),b(t("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=o=>n.value.text=o),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 bg-gray-50 text-gray-800",placeholder:e.$t("admin_splash_placeholder_text")},null,8,Ue),[[v,n.value.text]])]),n.value.image||n.value.text?(l(),d("div",Ve,[t("p",Le,s(e.$t("admin_splash_preview")),1),t("div",Ne,[n.value.image?(l(),d("img",{key:0,src:n.value.image,class:"w-32 h-auto rounded shadow-lg"},null,8,Pe)):p("",!0),n.value.text?(l(),d("p",Be,s(n.value.text),1)):p("",!0)])])):p("",!0),t("div",Fe,[t("button",{onClick:E,disabled:h.value,class:"flex-1 px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50"},s(h.value?e.$t("profile_submitting"):e.$t("admin_splash_save")),9,Oe),t("button",{onClick:D,class:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},s(e.$t("admin_splash_clear")),1)])])])])):p("",!0)]))}}),Ae=F(je,[["__scopeId","data-v-124ffd16"]]);export{Ae as default};
