import{d as B,u as O,r as c,l as y,o as P,c as n,a as t,b as v,t as b,F as w,g as h,e as T,f as m,v as x,m as E,i as Q,h as k,n as R,j as a}from"./index-D7k-yHMH.js";const G={class:"container mx-auto p-4 md:p-6 max-w-3xl"},H={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md mb-6 border border-white/20"},J={class:"flex items-center justify-between mb-2"},K={class:"font-semibold text-lg"},W={class:"grid grid-cols-7 gap-1"},X={class:"bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-md mb-6 border border-white/20"},Z={class:"space-y-4"},ee=["value"],te={key:0,class:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-xl"},oe={class:"space-y-3"},se={class:"font-semibold"},le={class:"text-sm text-gray-700"},ne={key:0,class:"text-xs text-gray-500 mt-1 pl-1 border-l-2"},ae={class:"flex space-x-2"},re=["onClick"],de=["onClick"],ue={key:1,class:"text-center text-sm text-gray-500 mt-4"},ie={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},be={class:"space-y-4"},pe=["value"],ge={class:"mt-6 flex justify-end space-x-2"},fe=B({__name:"StoolView",setup(me){const d=O(),p=c(new Date),u=c([]),g=c(""),f=c(!1),r=c(null),i=c({log_date:new Date().toISOString().split("T")[0],stool_type:null,notes:""}),D={1:"颗粒状硬球",2:"香肠状，表面凹凸",3:"香肠状，表面有裂痕",4:"香肠或蛇状，光滑柔软",5:"断边光滑的柔软团块",6:"蓬松的糊状、烂便",7:"水样，无固体块"},_=y(()=>g.value?u.value.filter(s=>s.log_date.includes(g.value)||s.notes&&s.notes.includes(g.value)):u.value),M=y(()=>g.value?_.value:_.value.slice(0,3)),V=y(()=>{const s=p.value.getFullYear(),e=p.value.getMonth(),o=new Date(s,e,1).getDay(),l=new Date(s,e+1,0).getDate(),S=Array.from({length:l},(ce,A)=>A+1);return[...Array.from({length:o===0?6:o-1},()=>null),...S]}),j=y(()=>p.value.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})),U=y(()=>{const s=new Set;for(const e of u.value)e.log_date&&typeof e.log_date=="string"&&s.add(e.log_date.split("T")[0]);return s}),Y=async()=>{await $(),Q(()=>{typeof lucide<"u"&&lucide.createIcons()})},$=async()=>{try{u.value=await k("/stool-logs")}catch(s){s instanceof Error?d.showToast({message:`加载记录失败: ${s.message}`,type:"error"}):d.showToast({message:"加载记录失败: 未知错误",type:"error"})}},F=async()=>{try{const s={...i.value,stool_type:i.value.stool_type?Number(i.value.stool_type):null},e=await k("/stool-logs","POST",s);u.value.unshift(e),d.showToast({message:"记录已保存！"}),i.value={log_date:new Date().toISOString().split("T")[0],stool_type:null,notes:""}}catch(s){s instanceof Error?d.showToast({message:`保存失败: ${s.message}`,type:"error"}):d.showToast({message:"保存失败: 未知错误",type:"error"})}},I=s=>{r.value={...s,stool_type:s.stool_type||null,log_date:s.log_date.split("T")[0]},f.value=!0},N=async()=>{if(r.value)try{const s=await k(`/stool-logs/${r.value.id}`,"PUT",r.value),e=u.value.findIndex(o=>o.id===s.id);e!==-1&&(u.value[e]=s),d.showToast({message:"更新成功！"}),f.value=!1,r.value=null,await $()}catch(s){s instanceof Error?d.showToast({message:`更新失败: ${s.message}`,type:"error"}):d.showToast({message:"更新失败: 未知错误",type:"error"})}},q=async s=>{if(confirm("确定要删除这条记录吗？"))try{await k(`/stool-logs/${s.id}`,"DELETE"),u.value=u.value.filter(e=>e.id!==s.id),d.showToast({message:"删除成功"})}catch(e){e instanceof Error?d.showToast({message:`删除失败: ${e.message}`,type:"error"}):d.showToast({message:"删除失败: 未知错误",type:"error"})}},L=s=>{const e=new Date(p.value);e.setMonth(e.getMonth()+s),p.value=e},z=s=>{const e={},o=new Date,l=o.getDate()===s&&o.getMonth()===p.value.getMonth()&&o.getFullYear()===p.value.getFullYear(),S=`${p.value.getFullYear()}-${String(p.value.getMonth()+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`,C=U.value.has(S);return l&&(e["bg-blue-100"]=!0,e["text-blue-600"]=!0,e["font-bold"]=!0),C&&(e["bg-red-200"]=!0,e["text-red-700"]=!0,e["font-semibold"]=!0),e};return P(Y),(s,e)=>(a(),n("div",G,[e[28]||(e[28]=t("header",{class:"mb-6"},[t("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[t("h1",{class:"text-2xl font-bold"},"排便记录"),t("p",{class:"text-gray-500 mt-1"},"记录您的每日健康状况")])],-1)),t("div",H,[t("div",J,[t("button",{onClick:e[0]||(e[0]=o=>L(-1)),class:"p-2 rounded-full hover:bg-gray-200"},[...e[11]||(e[11]=[t("i",{"data-lucide":"chevron-left"},null,-1)])]),t("h3",K,b(j.value),1),t("button",{onClick:e[1]||(e[1]=o=>L(1)),class:"p-2 rounded-full hover:bg-gray-200"},[...e[12]||(e[12]=[t("i",{"data-lucide":"chevron-right"},null,-1)])])]),e[13]||(e[13]=t("div",{class:"grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2"},[t("span",null,"一"),t("span",null,"二"),t("span",null,"三"),t("span",null,"四"),t("span",null,"五"),t("span",null,"六"),t("span",null,"日")],-1)),t("div",W,[(a(!0),n(w,null,h(V.value,(o,l)=>(a(),n("div",{key:l,class:"h-9 flex items-center justify-center"},[o?(a(),n("div",{key:0,class:R(["w-8 h-8 flex items-center justify-center rounded-full relative transition-colors",z(o)])},b(o),3)):v("",!0)]))),128))])]),t("div",X,[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold mb-4"},"添加记录",-1)),t("form",{onSubmit:T(F,["prevent"])},[t("div",Z,[t("div",null,[e[14]||(e[14]=t("label",{for:"stool-date-add",class:"block text-sm font-medium text-gray-700"},"日期",-1)),m(t("input",{type:"date",id:"stool-date-add","onUpdate:modelValue":e[2]||(e[2]=o=>i.value.log_date=o),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,i.value.log_date]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"stool-type-add",class:"block text-sm font-medium text-gray-700"},"大便类型 (布里斯托分类法)",-1)),m(t("select",{id:"stool-type-add","onUpdate:modelValue":e[3]||(e[3]=o=>i.value.stool_type=o),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[e[15]||(e[15]=t("option",{value:null},"不记录类型",-1)),(a(),n(w,null,h(D,(o,l)=>t("option",{key:l,value:l}," 类型"+b(l)+": "+b(o),9,ee)),64))],512),[[E,i.value.stool_type,void 0,{number:!0}]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"stool-notes-add",class:"block text-sm font-medium text-gray-700"},"备注",-1)),m(t("textarea",{id:"stool-notes-add","onUpdate:modelValue":e[4]||(e[4]=o=>i.value.notes=o),rows:"3",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"例如：颜色、感觉等..."},null,512),[[x,i.value.notes]])])]),e[18]||(e[18]=t("div",{class:"mt-6 flex justify-end"},[t("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all flex items-center space-x-2"},[t("i",{"data-lucide":"save",class:"w-5 h-5"}),t("span",null,"保存记录")])],-1))],32)]),t("main",null,[e[21]||(e[21]=t("h2",{class:"text-xl font-semibold mb-4"},"历史记录",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),placeholder:"按日期(YYYY-MM-DD)或备注搜索...",class:"w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm mb-4"},null,512),[[x,g.value]]),M.value.length===0?(a(),n("div",te,[t("p",null,b(g.value?"没有找到匹配的记录":"最近没有记录"),1)])):v("",!0),t("div",oe,[(a(!0),n(w,null,h(M.value,o=>(a(),n("div",{key:o.id,class:"bg-white/80 backdrop-blur-sm p-4 rounded-lg shadow-sm flex justify-between items-start border border-white/20"},[t("div",null,[t("p",se,b(new Date(o.log_date).toLocaleDateString()),1),t("p",le,b(o.stool_type?`类型${o.stool_type}: ${D[o.stool_type]}`:"已记录"),1),o.notes?(a(),n("p",ne," 备注: "+b(o.notes),1)):v("",!0)]),t("div",ae,[t("button",{onClick:l=>I(o),class:"text-blue-500 hover:text-blue-700 p-1"},[...e[20]||(e[20]=[t("i",{"data-lucide":"edit-3",class:"w-4 h-4"},null,-1)])],8,re),t("button",{onClick:l=>q(o),class:"text-xs bg-red-100 text-red-600 hover:bg-red-200 rounded-full px-2 py-1 font-semibold transition-colors"}," 删除 ",8,de)])]))),128))]),!g.value&&u.value.length>3?(a(),n("p",ue," 仅显示最近3条记录，使用搜索框查看更多。 ")):v("",!0)]),f.value?(a(),n("div",{key:0,onClick:e[10]||(e[10]=T(o=>f.value=!1,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[t("div",ie,[e[27]||(e[27]=t("h2",{class:"text-xl font-bold mb-4"},"编辑记录",-1)),r.value?(a(),n("form",{key:0,onSubmit:T(N,["prevent"])},[t("div",be,[t("div",null,[e[22]||(e[22]=t("label",{for:"stool-date-edit",class:"block text-sm font-medium text-gray-700"},"日期",-1)),m(t("input",{type:"date",id:"stool-date-edit","onUpdate:modelValue":e[6]||(e[6]=o=>r.value.log_date=o),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,r.value.log_date]])]),t("div",null,[e[24]||(e[24]=t("label",{for:"stool-type-edit",class:"block text-sm font-medium text-gray-700"},"大便类型",-1)),m(t("select",{id:"stool-type-edit","onUpdate:modelValue":e[7]||(e[7]=o=>r.value.stool_type=o),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[e[23]||(e[23]=t("option",{value:null},"不记录类型",-1)),(a(),n(w,null,h(D,(o,l)=>t("option",{key:l,value:l}," 类型"+b(l)+": "+b(o),9,pe)),64))],512),[[E,r.value.stool_type,void 0,{number:!0}]])]),t("div",null,[e[25]||(e[25]=t("label",{for:"stool-notes-edit",class:"block text-sm font-medium text-gray-700"},"备注",-1)),m(t("textarea",{id:"stool-notes-edit","onUpdate:modelValue":e[8]||(e[8]=o=>r.value.notes=o),rows:"3",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,r.value.notes]])])]),t("div",ge,[t("button",{type:"button",onClick:e[9]||(e[9]=o=>f.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg"}," 取消 "),e[26]||(e[26]=t("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg"}," 保存更改 ",-1))])],32)):v("",!0)])])):v("",!0)]))}});export{fe as default};
