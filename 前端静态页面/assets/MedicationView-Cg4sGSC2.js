import{d as F,r as f,u as A,w as D,c as I,o as B,a as n,b as t,e as c,f as _,F as w,g as h,h as x,v as y,i as C,t as u,j as b,n as M,k as i}from"./index-B-AndoMI.js";const O={class:"container mx-auto p-4 md:p-6 max-w-3xl mobile-px-0"},P={class:"flex justify-between items-center mb-6"},z={key:0,class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-lg shadow-md",role:"alert"},H={class:"flex"},R={class:"text-sm"},G={key:1,class:"bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-md mb-6 border border-white/20"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},K={class:"md:col-span-2"},Q={class:"md:col-span-2"},W={class:"md:col-span-2"},X={class:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-1"},Y=["onUpdate:modelValue"],Z={class:"mt-6 flex justify-end space-x-3"},ee={class:"space-y-4"},te={key:0,class:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-xl"},se={class:"flex flex-col md:flex-row justify-between items-start md:items-center"},oe={class:"flex-1 mb-4 md:mb-0"},le={class:"text-lg font-bold"},ae={class:"text-sm"},re={key:0,class:"text-sm"},ne={class:"text-sm flex items-center"},ie={class:"font-semibold text-lg ml-1"},de={key:0,class:"ml-2 text-red-500 flex items-center text-xs font-bold bg-red-100 px-2 py-0.5 rounded-full"},ue={class:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 w-full md:w-auto"},ce=["onClick"],me=["onClick"],be=["onClick"],pe=["onClick"],fe={class:"glass-card max-w-md w-full p-8 shadow-2xl relative overflow-hidden animate-slide-up"},ge={class:"text-xl font-bold mb-6 flex items-center space-x-2"},xe={key:0,class:"space-y-3 max-h-80 overflow-y-auto pr-2 custom-scrollbar"},ye={class:"font-medium opacity-80"},ve=["onClick"],we={key:1,class:"text-on-surface-variant/40 text-center py-12 flex flex-col items-center"},he={class:"mt-8"},Te=F({__name:"MedicationView",setup(ke){const d=f([]),g=f(!1),r=f({name:"",dosage:"",frequency:1,stock:null,times:["08:00"]}),l=A(),v=f(!1),p=f([]),T=f("");D(()=>r.value.frequency,o=>{const e=o||1,s=r.value.times;if(e>s.length)for(let a=s.length;a<e;a++)s.push("12:00");else r.value.times=s.slice(0,e)});const k=I(()=>d.value.filter(o=>$(o))),$=o=>{if(o.stock===null||o.stock===void 0)return!1;const e=parseFloat(o.dosage)||0;if(e<=0)return!1;const s=e*3;return o.stock<s},E=async()=>{try{d.value=await b("/medications"),M(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(o){o instanceof Error?l.showToast({message:`加载用药记录失败: ${o.message}`,type:"error"}):l.showToast({message:"加载用药记录失败: 未知错误",type:"error"})}},S=async()=>{try{const o={...r.value,medication_times:r.value.times.join(",")},e=await b("/medications","POST",o);d.value.unshift(e),l.showToast({message:"添加成功！"}),g.value=!1,r.value={name:"",dosage:"",frequency:1,stock:null,times:["08:00"]}}catch(o){o instanceof Error?l.showToast({message:`添加失败: ${o.message}`,type:"error"}):l.showToast({message:"添加失败: 未知错误",type:"error"})}},q=async o=>{if(confirm(`确定要删除 "${o.name}" 吗?`))try{await b(`/medications/${o.id}`,"DELETE"),d.value=d.value.filter(e=>e.id!==o.id),l.showToast({message:"删除成功"})}catch(e){e instanceof Error?l.showToast({message:`删除失败: ${e.message}`,type:"error"}):l.showToast({message:"删除失败: 未知错误",type:"error"})}},V=async o=>{const e=prompt(`为 "${o.name}" 补充多少库存?`,"10");if(e){const s=parseInt(e,10);if(!isNaN(s)){const a={...o,stock:(o.stock||0)+s};try{await b(`/medications/${o.id}`,"PUT",a);const m=d.value.find(U=>U.id===o.id);m&&(m.stock=a.stock),l.showToast({message:"库存补充成功"})}catch(m){m instanceof Error?l.showToast({message:`补充失败: ${m.message}`,type:"error"}):l.showToast({message:"补充失败: 未知错误",type:"error"})}}}},N=async o=>{const e=parseFloat(o.dosage)||1;if(o.stock&&o.stock>=e)try{await b(`/medications/${o.id}/take`,"POST",{dosageAmount:e});const s=d.value.find(a=>a.id===o.id);s&&s.stock&&(s.stock-=e),l.showToast({message:`已服用: ${o.name}`})}catch(s){s instanceof Error?l.showToast({message:`操作失败: ${s.message}`,type:"error"}):l.showToast({message:"操作失败: 未知错误",type:"error"})}else l.showToast({message:"库存不足！",type:"error"})},j=async o=>{try{T.value=o.name,p.value=await b(`/medications/${o.id}/logs`),v.value=!0,M(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(e){e instanceof Error?l.showToast({message:`加载历史失败: ${e.message}`,type:"error"}):l.showToast({message:"加载历史失败: 未知错误",type:"error"})}},L=async o=>{if(confirm("确定要删除这条服药记录吗？"))try{await b(`/medications/logs/${o}`,"DELETE"),p.value=p.value.filter(e=>e.id!==o),l.showToast({message:"记录删除成功"})}catch(e){e instanceof Error?l.showToast({message:`删除失败: ${e.message}`,type:"error"}):l.showToast({message:"删除失败: 未知错误",type:"error"})}};return B(()=>{E()}),(o,e)=>(i(),n("div",O,[t("header",P,[e[9]||(e[9]=t("div",{class:"bg-white/80 backdrop-blur-sm px-4 md:px-6 py-3 md:py-4 rounded-xl shadow border border-white/20"},[t("h1",{class:"text-xl md:text-2xl font-bold"},"用药记录"),t("p",{class:"text-xs md:text-gray-500 mt-1"},"管理您的用药计划")],-1)),t("button",{onClick:e[0]||(e[0]=s=>g.value=!g.value),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 md:px-4 rounded-lg shadow-md transition-all flex items-center space-x-1 md:space-x-2 text-sm md:text-base"},[...e[8]||(e[8]=[t("i",{"data-lucide":"plus-circle",class:"w-5 h-5"},null,-1),t("span",{class:"hidden sm:inline"},"添加药品",-1),t("span",{class:"sm:hidden"},"添加",-1)])])]),k.value.length>0?(i(),n("div",z,[t("div",H,[e[12]||(e[12]=t("div",{class:"py-1"},[t("i",{"data-lucide":"alert-triangle",class:"h-6 w-6 text-red-500 mr-4"})],-1)),t("div",null,[e[11]||(e[11]=t("p",{class:"font-bold"},"库存不足提醒",-1)),t("p",R,[e[10]||(e[10]=_(" 以下药品库存已不足未来三次用量，请及时补充: ",-1)),(i(!0),n(w,null,h(k.value,(s,a)=>(i(),n("span",{key:s.id,class:"font-semibold"},u(s.name)+u(a<k.value.length-1?", ":""),1))),128))])])])])):c("",!0),g.value?(i(),n("div",G,[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold mb-4"},"添加新的用药计划",-1)),t("form",{onSubmit:C(S,["prevent"])},[t("div",J,[t("div",K,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"药品名称",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>r.value.name=s),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,r.value.name]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"每次用量",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>r.value.dosage=s),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,r.value.dosage]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"每日次数",-1)),x(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=s=>r.value.frequency=s),min:"1",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,r.value.frequency,void 0,{number:!0}]])]),t("div",Q,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"当前库存",-1)),x(t("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=s=>r.value.stock=s),min:"0",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,r.value.stock,void 0,{number:!0}]])]),t("div",W,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"服药时间",-1)),t("div",X,[(i(!0),n(w,null,h(r.value.times,(s,a)=>(i(),n("div",{key:a},[x(t("input",{type:"time","onUpdate:modelValue":m=>r.value.times[a]=m,required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,8,Y),[[y,r.value.times[a]]])]))),128))])])]),t("div",Z,[t("button",{type:"button",onClick:e[5]||(e[5]=s=>g.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 取消 "),e[18]||(e[18]=t("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all"}," 确认添加 ",-1))])],32)])):c("",!0),t("main",ee,[d.value.length===0?(i(),n("div",te,[...e[20]||(e[20]=[t("i",{"data-lucide":"pilcrow",class:"mx-auto h-12 w-12 text-gray-400"},null,-1),t("h3",{class:"mt-2 text-sm font-medium"},"暂无药品记录",-1)])])):c("",!0),(i(!0),n(w,null,h(d.value,s=>(i(),n("div",{key:s.id,class:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-5 border-l-4 border-blue-500 border-white/20"},[t("div",se,[t("div",oe,[t("h3",le,u(s.name),1),t("p",ae," 用法: "+u(s.dosage||"未设置")+" / 每次, "+u(s.frequency||"N/A")+"次 / 每日 ",1),s.medication_times?(i(),n("p",re,"时间: "+u(s.medication_times),1)):c("",!0),t("p",ne,[e[22]||(e[22]=_(" 库存: ",-1)),t("span",ie,u(s.stock||0),1),$(s)?(i(),n("span",de,[...e[21]||(e[21]=[t("i",{"data-lucide":"alert-circle",class:"w-4 h-4 mr-1"},null,-1),_(" 库存不足 ",-1)])])):c("",!0)])]),t("div",ue,[t("button",{onClick:a=>N(s),class:"bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 服用 ",8,ce),t("button",{onClick:a=>j(s),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 记录 ",8,me),t("button",{onClick:a=>V(s),class:"bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 补充 ",8,be),t("button",{onClick:a=>q(s),class:"bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 删除 ",8,pe)])])]))),128))]),v.value?(i(),n("div",{key:2,onClick:e[7]||(e[7]=C(s=>v.value=!1,["self"])),class:"fixed inset-0 bg-black/40 backdrop-blur-md flex items-center justify-center p-4 z-50 animate-fade-in"},[t("div",fe,[e[25]||(e[25]=t("div",{class:"absolute top-0 right-0 p-8 opacity-5 pointer-events-none"},[t("i",{"data-lucide":"history",class:"w-32 h-32 text-blue-500"})],-1)),t("h2",ge,[e[23]||(e[23]=t("i",{"data-lucide":"clock",class:"w-5 h-5 text-blue-500"},null,-1)),t("span",null,'"'+u(T.value)+'" 的服药历史',1)]),p.value.length>0?(i(),n("ul",xe,[(i(!0),n(w,null,h(p.value,s=>(i(),n("li",{key:s.id,class:"flex justify-between items-center p-4 bg-white/5 border border-white/10 rounded-2xl text-sm hover:bg-white/10 transition-colors"},[t("span",ye,u(new Date(s.taken_at).toLocaleString("zh-CN")),1),t("button",{onClick:a=>L(s.id),class:"text-red-400 hover:text-red-300 font-bold text-xs uppercase tracking-widest px-3 py-1 bg-red-500/10 rounded-full transition-all active:scale-95"}," 删除 ",8,ve)]))),128))])):c("",!0),p.value.length===0?(i(),n("div",we,[...e[24]||(e[24]=[t("i",{"data-lucide":"inbox",class:"w-12 h-12 mb-2 opacity-20"},null,-1),t("p",{class:"text-sm"},"暂无服药记录",-1)])])):c("",!0),t("div",he,[t("button",{onClick:e[6]||(e[6]=s=>v.value=!1),class:"w-full py-3 bg-white/10 hover:bg-white/20 text-on-surface font-bold rounded-2xl transition-all active:scale-[0.98]"}," 关闭 ")])])])):c("",!0)]))}});export{Te as default};
