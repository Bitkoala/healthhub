import{d as me,u as ce,r as u,c as R,o as be,a as l,b as t,e as p,q as L,t as o,F as D,g as h,h as r,v,y as ve,p as ye,i as T,l as B,f as xe,n as ge,j as x,k as a}from"./index-BjI3jnMU.js";import{C as fe,p as we,a as ke,b as _e,B as De,c as he,L as $e,d as Ce}from"./index-DZiQw30u.js";function U(){const I=new Date,d=I.getFullYear(),k=(I.getMonth()+1).toString().padStart(2,"0"),j=I.getDate().toString().padStart(2,"0");return`${d}-${k}-${j}`}const Te={class:"container mx-auto p-4 md:p-6 max-w-4xl"},Se={class:"flex items-center justify-between bg-white/80 backdrop-blur-sm p-2 rounded-xl shadow-md mb-6 border border-white/20"},Ve={key:0},Le={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},Ue={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},je={class:"text-2xl font-bold"},Ee={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},qe={class:"text-2xl font-bold text-green-600"},Ne={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},Fe={class:"text-2xl font-bold text-red-600"},Oe={class:"md:col-span-3 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow border"},Be={class:"text-3xl font-bold text-blue-600"},Ie={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border"},Pe={class:"flex justify-between items-center mb-4"},Ae={class:"space-y-2"},Me={class:"font-semibold"},Re={class:"mt-6 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border"},ze={class:"flex flex-wrap items-center gap-4 mb-4"},He={class:"relative h-80"},Ye={key:1,class:"flex items-center justify-center h-full text-gray-500"},Ge={key:1},Je={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border"},Ke={class:"flex justify-between items-center mb-4"},Qe={class:"space-y-3"},We={class:"font-semibold"},Xe={class:"text-xs text-gray-500"},Ze={key:0,class:"text-xs text-gray-500 mt-1"},et={class:"flex items-center gap-3"},tt=["onClick"],st={class:"mt-6 border-t pt-4"},nt={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg"},at={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end"},lt=["disabled"],ot={key:0,class:"mt-4"},rt={key:0,class:"text-gray-500"},dt={key:1,class:"space-y-3 max-h-96 overflow-y-auto"},ut={class:"font-semibold"},it={class:"text-xs text-gray-500"},pt={key:0,class:"text-xs text-gray-500 mt-1"},mt={class:"flex items-center gap-3"},ct=["onClick"],bt={key:2},vt={class:"bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-md border"},yt={class:"flex justify-between items-center mb-4"},xt={class:"space-y-3"},gt={class:"flex justify-between items-start"},ft={class:"font-semibold"},wt={class:"text-xs text-gray-500"},kt={key:0,class:"text-xs text-gray-500 mt-1"},_t={class:"text-right"},Dt={key:0,class:"text-xs text-orange-500"},ht={key:1,class:"text-xs text-gray-400"},$t={class:"flex justify-end items-center gap-2 mt-2"},Ct=["onClick"],Tt=["onClick"],St=["onClick"],Vt={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},Lt={class:"flex justify-end space-x-2"},Ut=["value"],jt={class:"flex justify-end space-x-2"},Et=["value"],qt={class:"flex justify-end space-x-2"},Nt={key:0,class:"bg-white rounded-xl shadow-2xl max-w-lg w-full p-6"},Ft={class:"text-xl font-bold mb-4"},Ot={key:0,class:"space-y-2 max-h-80 overflow-y-auto pr-2"},Bt={class:"font-semibold text-green-600"},It={class:"text-sm text-gray-500"},Pt={class:"flex items-center gap-4"},At={class:"text-sm text-gray-600"},Mt=["onClick"],Rt={key:1,class:"text-gray-500 my-4"},zt={class:"mt-6 text-right"},Ht={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},Yt={class:"text-xl font-bold"},Gt={class:"text-sm text-gray-600"},Jt={class:"font-bold"},Kt=["max"],Qt=["value"],Wt={class:"flex justify-end space-x-2"},es=me({__name:"FinanceView",setup(I){fe.register(we,ke,_e,De,he,$e);const d=ce(),k=u([]),j=u([]),P=u([]),z=u([]),w=u("dashboard"),y=u(null),E=u(!1),q=u(!1),A=u(!1),M=u(!1),$=u({account_name:"",initial_balance:0}),c=u({account_id:null,transaction_type:"expense",amount:null,category:"",notes:"",transaction_date:U()}),m=u({loan_type:"lend",person_name:"",amount:null,notes:"",loan_date:U(),account_id:null}),g=u({id:null,person_name:"",remaining_amount:0,amount:null,account_id:null,repayment_date:U()}),N=u({startDate:"",endDate:""}),F=u(null),O=u(null),S=u([]),H=u(null),V=u({startDate:new Date(new Date().setDate(new Date().getDate()-6)).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),Z={responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!1},y:{stacked:!1}},plugins:{tooltip:{callbacks:{label:function(n){let e=n.dataset.label||"";return e&&(e+=": "),n.parsed.y!==null&&(e+=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(n.parsed.y)),e}}}}},G=R(()=>k.value.reduce((n,e)=>n+Number(e.current_balance),0)),J=R(()=>P.value.filter(n=>n.loan_type==="lend"&&n.status==="unpaid").reduce((n,e)=>n+Number(e.amount),0)),K=R(()=>P.value.filter(n=>n.loan_type==="borrow"&&n.status==="unpaid").reduce((n,e)=>n+Number(e.amount),0)),ee=R(()=>G.value+J.value-K.value),C=async()=>{try{await Promise.all([Q(),te(),se()]),X()}finally{ge(()=>{typeof lucide<"u"&&lucide.createIcons()})}},Q=async()=>{k.value=await x("/finance/accounts")},te=async()=>{const n=await x("/finance/transactions?limit=all");n?(z.value=n,j.value=n.slice(0,10)):(z.value=[],j.value=[])},se=async()=>{P.value=await x("/finance/loans")},ne=async()=>{if(!$.value.account_name){d.showToast({message:"账户名称不能为空",type:"error"});return}await x("/finance/accounts","POST",$.value),d.showToast({message:"账户已添加"}),await Q(),y.value=null,$.value={account_name:"",initial_balance:0}},ae=async()=>{if(!c.value.account_id||!c.value.amount){d.showToast({message:"账户和金额为必填项",type:"error"});return}await x("/finance/transactions","POST",c.value),d.showToast({message:"交易已记录"}),await C(),y.value=null,c.value={account_id:null,transaction_type:"expense",amount:null,category:"",notes:"",transaction_date:U()}},le=async()=>{if(!m.value.person_name||!m.value.amount||!m.value.account_id){d.showToast({message:"对方姓名、金额和关联账户为必填项",type:"error"});return}await x("/finance/loans","POST",m.value),d.showToast({message:"借贷已记录"}),await C(),y.value=null,m.value={loan_type:"lend",person_name:"",amount:null,notes:"",loan_date:U(),account_id:null}},W=async n=>{if(confirm(`确定要删除这笔交易吗？
(${n.category||"交易"} - ${b(n.amount)})`))try{await x(`/finance/transactions/${n.id}`,"DELETE"),d.showToast({message:"交易已删除"}),await C()}catch(e){e instanceof Error&&d.showToast({message:`删除失败: ${e.message}`,type:"error"})}},oe=async n=>{if(confirm(`确定要删除这笔与 ${n.person_name} 的借贷记录吗？其关联的所有还款记录也会被一并删除。`))try{await x(`/finance/loans/${n.id}`,"DELETE"),d.showToast({message:"借贷记录已删除"}),await C()}catch(e){e instanceof Error&&d.showToast({message:`删除失败: ${e.message}`,type:"error"})}},re=async n=>{O.value=n;try{S.value=await x(`/finance/loans/${n.id}/repayments`),q.value=!0}catch(e){e instanceof Error&&d.showToast({message:`获取还款历史失败: ${e.message}`,type:"error"}),S.value=[]}},de=async n=>{if(confirm(`确定要删除这笔 ${new Date(n.repayment_date).toLocaleDateString()} 的还款记录吗？金额为 ${b(n.amount)}。
此操作也会删除关联的交易明细。`)&&O.value)try{await x(`/finance/repayments/${n.id}`,"DELETE"),d.showToast({message:"还款记录已删除"});const e=O.value.id;await C();const s=await x(`/finance/loans/${e}/repayments`);S.value=s||[],S.value.length===0&&(q.value=!1)}catch(e){e instanceof Error&&d.showToast({message:`删除失败: ${e.message}`,type:"error"})}},ue=n=>{g.value={id:n.id,person_name:n.person_name,remaining_amount:n.remaining_amount,amount:null,account_id:null,repayment_date:U()},E.value=!0},ie=async()=>{const{id:n,amount:e,account_id:s,repayment_date:f}=g.value;if(!e||!s){d.showToast({message:"还款金额和账户为必填项",type:"error"});return}try{await x(`/finance/loans/${n}/repay`,"POST",{amount:e,account_id:s,repayment_date:f}),d.showToast({message:"还款成功"}),await C(),E.value=!1}catch(i){i instanceof Error&&d.showToast({message:`还款失败: ${i.message}`,type:"error"})}},pe=async()=>{const{startDate:n,endDate:e}=N.value;if(!n||!e){d.showToast({message:"请选择开始和结束日期",type:"error"});return}M.value=!0;try{const s=new URLSearchParams({startDate:n,endDate:e}).toString();F.value=await x(`/finance/transactions?${s}`)}catch(s){s instanceof Error&&d.showToast({message:`查询失败: ${s.message}`,type:"error"}),F.value=[]}finally{M.value=!1}},b=n=>n===null||typeof n>"u"?"":new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(n),X=()=>{const n=new Date(V.value.startDate);n.setHours(0,0,0,0);const e=new Date(V.value.endDate);e.setHours(23,59,59,999);const s={};for(let i=new Date(n);i<=e;i.setDate(i.getDate()+1)){const _=i.toISOString().split("T")[0];s[_]={income:0,expense:0}}z.value.forEach(i=>{const _=new Date(i.transaction_date);if(_>=n&&_<=e){const Y=_.toISOString().split("T")[0];s[Y]&&(i.transaction_type==="income"?s[Y].income+=Number(i.amount):s[Y].expense+=Number(i.amount))}});const f=Object.keys(s).sort();H.value={labels:f.map(i=>{const _=new Date(i);return`${_.getMonth()+1}/${_.getDate()}`}),datasets:[{label:"收入",backgroundColor:"#4ade80",data:f.map(i=>s[i].income)},{label:"支出",backgroundColor:"#f87171",data:f.map(i=>s[i].expense)}]}};return be(C),(n,e)=>(a(),l("div",Te,[e[81]||(e[81]=t("header",{class:"mb-6"},[t("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[t("h1",{class:"text-2xl font-bold"},"个人记账"),t("p",{class:"text-gray-500 mt-1"},"清晰掌握您的财务状况")])],-1)),t("div",Se,[t("button",{onClick:e[0]||(e[0]=s=>w.value="dashboard"),class:L([{"bg-blue-500 text-white":w.value==="dashboard"},"flex-1 py-2 px-4 rounded-lg"])}," 总览 ",2),t("button",{onClick:e[1]||(e[1]=s=>w.value="transactions"),class:L([{"bg-blue-500 text-white":w.value==="transactions"},"flex-1 py-2 px-4 rounded-lg"])}," 交易明细 ",2),t("button",{onClick:e[2]||(e[2]=s=>w.value="loans"),class:L([{"bg-blue-500 text-white":w.value==="loans"},"flex-1 py-2 px-4 rounded-lg"])}," 借还款 ",2)]),w.value==="dashboard"?(a(),l("div",Ve,[t("div",Le,[t("div",Ue,[e[36]||(e[36]=t("p",{class:"text-sm text-gray-500"},"总资产",-1)),t("p",je,o(b(G.value)),1)]),t("div",Ee,[e[37]||(e[37]=t("p",{class:"text-sm text-gray-500"},"总借出",-1)),t("p",qe,o(b(J.value)),1)]),t("div",Ne,[e[38]||(e[38]=t("p",{class:"text-sm text-gray-500"},"总借入",-1)),t("p",Fe,o(b(K.value)),1)]),t("div",Oe,[e[39]||(e[39]=t("p",{class:"text-sm text-gray-500"},"净资产 (总资产 + 总借出 - 总借入)",-1)),t("p",Be,o(b(ee.value)),1)])]),t("div",Ie,[t("div",Pe,[e[40]||(e[40]=t("h2",{class:"text-xl font-semibold"},"我的账户",-1)),t("button",{onClick:e[3]||(e[3]=s=>y.value="account"),class:"bg-blue-500 text-white py-1 px-3 rounded-lg text-sm"}," 添加账户 ")]),t("ul",Ae,[(a(!0),l(D,null,h(k.value,s=>(a(),l("li",{key:s.id,class:"flex justify-between items-center p-2 bg-gray-50 rounded-md"},[t("span",null,o(s.account_name),1),t("span",Me,o(b(s.current_balance)),1)]))),128))])]),t("div",Re,[e[43]||(e[43]=t("h2",{class:"text-xl font-semibold mb-2"},"收支图表分析",-1)),t("div",ze,[t("div",null,[e[41]||(e[41]=t("label",{for:"chart-start-date",class:"text-sm font-medium text-gray-700"},"开始日期",-1)),r(t("input",{type:"date",id:"chart-start-date","onUpdate:modelValue":e[4]||(e[4]=s=>V.value.startDate=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"},null,512),[[v,V.value.startDate]])]),t("div",null,[e[42]||(e[42]=t("label",{for:"chart-end-date",class:"text-sm font-medium text-gray-700"},"结束日期",-1)),r(t("input",{type:"date",id:"chart-end-date","onUpdate:modelValue":e[5]||(e[5]=s=>V.value.endDate=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"},null,512),[[v,V.value.endDate]])]),t("div",{class:"self-end"},[t("button",{onClick:X,class:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," 更新图表 ")])]),t("div",He,[H.value?(a(),ve(ye(Ce),{key:0,data:H.value,options:Z},null,8,["data"])):(a(),l("div",Ye," 加载图表数据中... "))])])])):p("",!0),w.value==="transactions"?(a(),l("div",Ge,[t("div",Je,[t("div",Ke,[e[44]||(e[44]=t("h2",{class:"text-xl font-semibold"},"交易明细",-1)),t("button",{onClick:e[6]||(e[6]=s=>y.value="transaction"),class:"bg-blue-500 text-white py-1 px-3 rounded-lg text-sm"}," 记录一笔 ")]),t("ul",Qe,[(a(!0),l(D,null,h(j.value,s=>(a(),l("li",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-md"},[t("div",null,[t("p",We,o(s.category||(s.transaction_type==="income"?"收入":"支出")),1),t("p",Xe,o(new Date(s.transaction_date).toLocaleDateString())+" · "+o(s.account_name),1),s.notes?(a(),l("p",Ze,"备注: "+o(s.notes),1)):p("",!0)]),t("div",et,[t("p",{class:L(["font-bold text-right",s.transaction_type==="income"?"text-green-600":"text-red-600"])},o(s.transaction_type==="income"?"+":"-")+" "+o(b(s.amount)),3),t("button",{onClick:f=>W(s),class:"text-gray-400 hover:text-red-500 p-1 rounded-full"},[...e[45]||(e[45]=[t("i",{"data-lucide":"trash-2",class:"w-4 h-4"},null,-1)])],8,tt)])]))),128))]),t("div",st,[t("button",{onClick:e[7]||(e[7]=s=>A.value=!A.value),class:"text-sm text-blue-600 hover:underline"},o(A.value?"收起查询":"查询历史记录"),1),A.value?(a(),l("div",nt,[t("div",at,[t("div",null,[e[46]||(e[46]=t("label",{class:"block text-xs text-gray-600"},"开始日期",-1)),r(t("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=s=>N.value.startDate=s),class:"w-full p-2 border rounded-md text-sm"},null,512),[[v,N.value.startDate]])]),t("div",null,[e[47]||(e[47]=t("label",{class:"block text-xs text-gray-600"},"结束日期",-1)),r(t("input",{type:"date","onUpdate:modelValue":e[9]||(e[9]=s=>N.value.endDate=s),class:"w-full p-2 border rounded-md text-sm"},null,512),[[v,N.value.endDate]])]),t("button",{onClick:pe,disabled:M.value,class:"bg-blue-500 text-white py-2 px-4 rounded-md text-sm disabled:bg-gray-400"},o(M.value?"查询中...":"查询"),9,lt)]),F.value?(a(),l("div",ot,[e[49]||(e[49]=t("h3",{class:"text-lg font-semibold mb-2"},"查询结果",-1)),F.value.length===0?(a(),l("p",rt,"在选定日期范围内没有找到交易记录。")):(a(),l("ul",dt,[(a(!0),l(D,null,h(F.value,s=>(a(),l("li",{key:`search-${s.id}`,class:"flex justify-between items-center p-3 bg-white rounded-md shadow-sm"},[t("div",null,[t("p",ut,o(s.category||(s.transaction_type==="income"?"收入":"支出")),1),t("p",it,o(new Date(s.transaction_date).toLocaleDateString())+" · "+o(s.account_name),1),s.notes?(a(),l("p",pt,"备注: "+o(s.notes),1)):p("",!0)]),t("div",mt,[t("p",{class:L(["font-bold text-right",s.transaction_type==="income"?"text-green-600":"text-red-600"])},o(s.transaction_type==="income"?"+":"-")+" "+o(b(s.amount)),3),t("button",{onClick:f=>W(s),class:"text-gray-400 hover:text-red-500 p-1 rounded-full"},[...e[48]||(e[48]=[t("i",{"data-lucide":"trash-2",class:"w-4 h-4"},null,-1)])],8,ct)])]))),128))]))])):p("",!0)])):p("",!0)])])])):p("",!0),w.value==="loans"?(a(),l("div",bt,[t("div",vt,[t("div",yt,[e[50]||(e[50]=t("h2",{class:"text-xl font-semibold"},"借还款",-1)),t("button",{onClick:e[10]||(e[10]=s=>y.value="loan"),class:"bg-blue-500 text-white py-1 px-3 rounded-lg text-sm"}," 添加记录 ")]),t("ul",xt,[(a(!0),l(D,null,h(P.value,s=>(a(),l("li",{key:s.id,class:"p-3 bg-gray-50 rounded-md"},[t("div",gt,[t("div",null,[t("p",ft,o(s.person_name),1),t("p",wt,o(new Date(s.loan_date).toLocaleDateString()),1),s.notes?(a(),l("p",kt,"备注: "+o(s.notes),1)):p("",!0)]),t("div",_t,[t("p",{class:L(["font-bold",s.loan_type==="lend"?"text-green-600":"text-red-600"])},o(s.loan_type==="lend"?"借出":"借入")+" "+o(b(s.amount)),3),s.status==="unpaid"?(a(),l("div",Dt,[t("p",null,"已还: "+o(b(s.total_repaid)),1),t("p",null,"剩余: "+o(b(s.remaining_amount)),1)])):s.repayment_date?(a(),l("p",ht,o(`已于 ${new Date(s.repayment_date).toLocaleDateString()} 还清`),1)):p("",!0)])]),t("div",$t,[s.status==="unpaid"&&s.total_repaid>0?(a(),l("button",{key:0,onClick:f=>re(s),class:"text-xs bg-gray-100 text-gray-700 hover:bg-gray-200 py-1 px-3 rounded-md"}," 还款历史 ",8,Ct)):p("",!0),s.status==="unpaid"?(a(),l("button",{key:1,onClick:f=>ue(s),class:"text-xs bg-blue-100 text-blue-700 hover:bg-blue-200 py-1 px-3 rounded-md"}," 还款 ",8,Tt)):p("",!0),t("button",{onClick:f=>oe(s),class:"text-xs bg-red-100 text-red-700 hover:bg-red-200 py-1 px-3 rounded-md"}," 删除 ",8,St)])]))),128))])])])):p("",!0),y.value?(a(),l("div",{key:3,onClick:e[28]||(e[28]=T(s=>y.value=null,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[t("div",Vt,[y.value==="account"?(a(),l("form",{key:0,onSubmit:T(ne,["prevent"]),class:"space-y-4"},[e[54]||(e[54]=t("h2",{class:"text-xl font-bold"},"添加新账户",-1)),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm"},"账户名称",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>$.value.account_name=s),type:"text",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,$.value.account_name]])]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm"},"初始余额",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>$.value.initial_balance=s),type:"number",step:"0.01",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,$.value.initial_balance,void 0,{number:!0}]])]),t("div",Lt,[t("button",{type:"button",onClick:e[13]||(e[13]=s=>y.value=null),class:"py-2 px-4 rounded-lg bg-gray-200"}," 取消"),e[53]||(e[53]=t("button",{type:"submit",class:"py-2 px-4 rounded-lg bg-blue-500 text-white"},"保存",-1))])],32)):p("",!0),y.value==="transaction"?(a(),l("form",{key:1,onSubmit:T(ae,["prevent"]),class:"space-y-4"},[e[64]||(e[64]=t("h2",{class:"text-xl font-bold"},"记录一笔交易",-1)),t("div",null,[e[56]||(e[56]=t("label",{class:"block text-sm"},"类型",-1)),r(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>c.value.transaction_type=s),class:"w-full px-3 py-2 border rounded-md"},[...e[55]||(e[55]=[t("option",{value:"expense"},"支出",-1),t("option",{value:"income"},"收入",-1)])],512),[[B,c.value.transaction_type]])]),t("div",null,[e[58]||(e[58]=t("label",{class:"block text-sm"},"账户",-1)),r(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>c.value.account_id=s),required:"",class:"w-full px-3 py-2 border rounded-md"},[e[57]||(e[57]=t("option",{value:null,disabled:""},"选择一个账户",-1)),(a(!0),l(D,null,h(k.value,s=>(a(),l("option",{key:s.id,value:s.id},o(s.account_name),9,Ut))),128))],512),[[B,c.value.account_id,void 0,{number:!0}]])]),t("div",null,[e[59]||(e[59]=t("label",{class:"block text-sm"},"金额",-1)),r(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>c.value.amount=s),type:"number",step:"0.01",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,c.value.amount,void 0,{number:!0}]])]),t("div",null,[e[60]||(e[60]=t("label",{class:"block text-sm"},"分类 (可选)",-1)),r(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>c.value.category=s),type:"text",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,c.value.category]])]),t("div",null,[e[61]||(e[61]=t("label",{class:"block text-sm"},"日期",-1)),r(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>c.value.transaction_date=s),type:"date",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,c.value.transaction_date]])]),t("div",null,[e[62]||(e[62]=t("label",{class:"block text-sm"},"备注 (可选)",-1)),r(t("textarea",{"onUpdate:modelValue":e[19]||(e[19]=s=>c.value.notes=s),rows:"2",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,c.value.notes]])]),t("div",jt,[t("button",{type:"button",onClick:e[20]||(e[20]=s=>y.value=null),class:"py-2 px-4 rounded-lg bg-gray-200"}," 取消"),e[63]||(e[63]=t("button",{type:"submit",class:"py-2 px-4 rounded-lg bg-blue-500 text-white"},"保存",-1))])],32)):p("",!0),y.value==="loan"?(a(),l("form",{key:2,onSubmit:T(le,["prevent"]),class:"space-y-4"},[e[74]||(e[74]=t("h2",{class:"text-xl font-bold"},"记录一笔借贷",-1)),t("div",null,[e[66]||(e[66]=t("label",{class:"block text-sm"},"类型",-1)),r(t("select",{"onUpdate:modelValue":e[21]||(e[21]=s=>m.value.loan_type=s),class:"w-full px-3 py-2 border rounded-md"},[...e[65]||(e[65]=[t("option",{value:"lend"},"我借给别人",-1),t("option",{value:"borrow"},"别人借给我",-1)])],512),[[B,m.value.loan_type]])]),t("div",null,[e[67]||(e[67]=t("label",{class:"block text-sm"},"对方姓名",-1)),r(t("input",{"onUpdate:modelValue":e[22]||(e[22]=s=>m.value.person_name=s),type:"text",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,m.value.person_name]])]),t("div",null,[e[69]||(e[69]=t("label",{class:"block text-sm"},"关联账户",-1)),r(t("select",{"onUpdate:modelValue":e[23]||(e[23]=s=>m.value.account_id=s),required:"",class:"w-full px-3 py-2 border rounded-md"},[e[68]||(e[68]=t("option",{value:null,disabled:""},"选择资金账户",-1)),(a(!0),l(D,null,h(k.value,s=>(a(),l("option",{key:s.id,value:s.id},o(s.account_name)+" ("+o(b(s.current_balance))+") ",9,Et))),128))],512),[[B,m.value.account_id,void 0,{number:!0}]])]),t("div",null,[e[70]||(e[70]=t("label",{class:"block text-sm"},"金额",-1)),r(t("input",{"onUpdate:modelValue":e[24]||(e[24]=s=>m.value.amount=s),type:"number",step:"0.01",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,m.value.amount,void 0,{number:!0}]])]),t("div",null,[e[71]||(e[71]=t("label",{class:"block text-sm"},"日期",-1)),r(t("input",{"onUpdate:modelValue":e[25]||(e[25]=s=>m.value.loan_date=s),type:"date",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,m.value.loan_date]])]),t("div",null,[e[72]||(e[72]=t("label",{class:"block text-sm"},"备注 (可选)",-1)),r(t("textarea",{"onUpdate:modelValue":e[26]||(e[26]=s=>m.value.notes=s),rows:"2",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,m.value.notes]])]),t("div",qt,[t("button",{type:"button",onClick:e[27]||(e[27]=s=>y.value=null),class:"py-2 px-4 rounded-lg bg-gray-200"}," 取消"),e[73]||(e[73]=t("button",{type:"submit",class:"py-2 px-4 rounded-lg bg-blue-500 text-white"},"保存",-1))])],32)):p("",!0)])])):p("",!0),q.value?(a(),l("div",{key:4,onClick:e[30]||(e[30]=T(s=>q.value=!1,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[O.value?(a(),l("div",Nt,[t("h3",Ft,"“"+o(O.value.person_name)+"”的还款历史",1),S.value.length>0?(a(),l("div",Ot,[(a(!0),l(D,null,h(S.value,s=>(a(),l("div",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},[t("div",null,[t("p",Bt,o(b(s.amount)),1),t("p",It,"日期: "+o(new Date(s.repayment_date).toLocaleDateString()),1)]),t("div",Pt,[t("p",At,"通过 "+o(s.account_name),1),t("button",{onClick:f=>de(s),class:"text-xs bg-red-100 text-red-700 hover:bg-red-200 py-1 px-3 rounded-md"}," 删除 ",8,Mt)])]))),128))])):(a(),l("p",Rt,"暂无还款历史记录。")),t("div",zt,[t("button",{onClick:e[29]||(e[29]=s=>q.value=!1),class:"py-2 px-4 rounded-lg bg-gray-200"},"关闭")])])):p("",!0)])):p("",!0),E.value?(a(),l("div",{key:5,onClick:e[35]||(e[35]=T(s=>E.value=!1,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[t("div",Ht,[t("form",{onSubmit:T(ie,["prevent"]),class:"space-y-4"},[t("h2",Yt,'为 "'+o(g.value.person_name)+'" 还款',1),t("p",Gt,[e[75]||(e[75]=xe(" 剩余未还: ",-1)),t("span",Jt,o(b(g.value.remaining_amount)),1)]),t("div",null,[e[76]||(e[76]=t("label",{class:"block text-sm"},"还款金额",-1)),r(t("input",{"onUpdate:modelValue":e[31]||(e[31]=s=>g.value.amount=s),type:"number",step:"0.01",required:"",class:"w-full px-3 py-2 border rounded-md",max:g.value.remaining_amount},null,8,Kt),[[v,g.value.amount,void 0,{number:!0}]])]),t("div",null,[e[78]||(e[78]=t("label",{class:"block text-sm"},"收/付款账户",-1)),r(t("select",{"onUpdate:modelValue":e[32]||(e[32]=s=>g.value.account_id=s),required:"",class:"w-full px-3 py-2 border rounded-md"},[e[77]||(e[77]=t("option",{value:null,disabled:""},"选择一个账户",-1)),(a(!0),l(D,null,h(k.value,s=>(a(),l("option",{key:s.id,value:s.id},o(s.account_name)+" ("+o(b(s.current_balance))+") ",9,Qt))),128))],512),[[B,g.value.account_id,void 0,{number:!0}]])]),t("div",null,[e[79]||(e[79]=t("label",{class:"block text-sm"},"还款日期",-1)),r(t("input",{"onUpdate:modelValue":e[33]||(e[33]=s=>g.value.repayment_date=s),type:"date",required:"",class:"w-full px-3 py-2 border rounded-md"},null,512),[[v,g.value.repayment_date]])]),t("div",Wt,[t("button",{type:"button",onClick:e[34]||(e[34]=s=>E.value=!1),class:"py-2 px-4 rounded-lg bg-gray-200"}," 取消 "),e[80]||(e[80]=t("button",{type:"submit",class:"py-2 px-4 rounded-lg bg-blue-500 text-white"},"确认还款",-1))])],32)])])):p("",!0)]))}});export{es as default};
