import{d as j,r as b,u as U,w as L,o as D,c as r,a as s,b as x,e as _,f as p,v as y,F as v,g as h,n as F,t as c,h as m,i as T,j as i,k as A}from"./index-BH0FCm0V.js";const I={class:"container mx-auto p-4 md:p-6 max-w-3xl"},z={class:"flex justify-between items-center mb-6"},B={class:"bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-md mb-6 border border-white/20"},P={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},H={class:"md:col-span-2"},O={class:"md:col-span-2"},R={class:"md:col-span-2"},G={class:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-1"},J=["onUpdate:modelValue"],K={class:"mt-6 flex justify-end space-x-3"},Q={class:"space-y-4"},W={key:0,class:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-xl"},X={class:"flex flex-col md:flex-row justify-between items-start md:items-center"},Y={class:"flex-1 mb-4 md:mb-0"},Z={class:"text-lg font-bold"},ee={class:"text-sm"},se={key:0,class:"text-sm"},te={class:"text-sm"},oe={class:"font-semibold text-lg"},ae={class:"flex flex-wrap gap-2 w-full md:w-auto"},le=["onClick"],ne=["onClick"],re=["onClick"],ie=["onClick"],de={class:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6"},ue={class:"text-xl font-bold mb-4"},ce={key:0,class:"space-y-2 max-h-80 overflow-y-auto"},me=["onClick"],be={key:1,class:"text-gray-500 text-center py-4"},ge={class:"mt-6 text-right"},ye=j({__name:"MedicationView",setup(fe){const d=b([]),g=b(!1),l=b({name:"",dosage:"",frequency:1,stock:null,times:["08:00"]}),a=U(),w=b(!1),f=b([]),k=b("");L(()=>l.value.frequency,o=>{const e=o||1,t=l.value.times;if(e>t.length)for(let n=t.length;n<e;n++)t.push("12:00");else l.value.times=t.slice(0,e)});const $=async()=>{try{d.value=await m("/medications"),T(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(o){o instanceof Error?a.showToast({message:`加载用药记录失败: ${o.message}`,type:"error"}):a.showToast({message:"加载用药记录失败: 未知错误",type:"error"})}},C=async()=>{try{const o={...l.value,medication_times:l.value.times.join(",")},e=await m("/medications","POST",o);d.value.unshift(e),a.showToast({message:"添加成功！"}),g.value=!1,l.value={name:"",dosage:"",frequency:1,stock:null,times:["08:00"]}}catch(o){o instanceof Error?a.showToast({message:`添加失败: ${o.message}`,type:"error"}):a.showToast({message:"添加失败: 未知错误",type:"error"})}},M=async o=>{if(confirm(`确定要删除 "${o.name}" 吗?`))try{await m(`/medications/${o.id}`,"DELETE"),d.value=d.value.filter(e=>e.id!==o.id),a.showToast({message:"删除成功"})}catch(e){e instanceof Error?a.showToast({message:`删除失败: ${e.message}`,type:"error"}):a.showToast({message:"删除失败: 未知错误",type:"error"})}},E=async o=>{const e=prompt(`为 "${o.name}" 补充多少库存?`,"10");if(e){const t=parseInt(e,10);if(!isNaN(t)){const n={...o,stock:(o.stock||0)+t};try{await m(`/medications/${o.id}`,"PUT",n);const u=d.value.find(S=>S.id===o.id);u&&(u.stock=n.stock),a.showToast({message:"库存补充成功"})}catch(u){u instanceof Error?a.showToast({message:`补充失败: ${u.message}`,type:"error"}):a.showToast({message:"补充失败: 未知错误",type:"error"})}}}},V=async o=>{const e=parseFloat(o.dosage)||1;if(o.stock&&o.stock>=e)try{await m(`/medications/${o.id}/take`,"POST",{dosageAmount:e});const t=d.value.find(n=>n.id===o.id);t&&t.stock&&(t.stock-=e),a.showToast({message:`已服用: ${o.name}`})}catch(t){t instanceof Error?a.showToast({message:`操作失败: ${t.message}`,type:"error"}):a.showToast({message:"操作失败: 未知错误",type:"error"})}else a.showToast({message:"库存不足！",type:"error"})},q=async o=>{try{k.value=o.name,f.value=await m(`/medications/${o.id}/logs`),w.value=!0,T(()=>{typeof lucide<"u"&&lucide.createIcons()})}catch(e){e instanceof Error?a.showToast({message:`加载历史失败: ${e.message}`,type:"error"}):a.showToast({message:"加载历史失败: 未知错误",type:"error"})}},N=async o=>{if(confirm("确定要删除这条服药记录吗？"))try{await m(`/medications/logs/${o}`,"DELETE"),f.value=f.value.filter(e=>e.id!==o),a.showToast({message:"记录删除成功"})}catch(e){e instanceof Error?a.showToast({message:`删除失败: ${e.message}`,type:"error"}):a.showToast({message:"删除失败: 未知错误",type:"error"})}};return D(()=>{$()}),(o,e)=>(i(),r("div",I,[s("header",z,[e[9]||(e[9]=s("div",{class:"bg-white/80 backdrop-blur-sm px-6 py-4 rounded-xl shadow border border-white/20"},[s("h1",{class:"text-2xl font-bold"},"用药记录"),s("p",{class:"text-gray-500 mt-1"},"管理您的用药计划")],-1)),s("button",{onClick:e[0]||(e[0]=t=>g.value=!g.value),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all flex items-center space-x-2"},[...e[8]||(e[8]=[s("i",{"data-lucide":"plus-circle",class:"w-5 h-5"},null,-1),s("span",null,"添加药品",-1)])])]),s("div",{class:F(["form-container",{open:g.value}])},[s("div",B,[e[16]||(e[16]=s("h2",{class:"text-xl font-semibold mb-4"},"添加新的用药计划",-1)),s("form",{onSubmit:_(C,["prevent"])},[s("div",P,[s("div",H,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-gray-700"},"药品名称",-1)),p(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>l.value.name=t),required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.name]])]),s("div",null,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-gray-700"},"每次用量",-1)),p(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>l.value.dosage=t),class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.dosage]])]),s("div",null,[e[12]||(e[12]=s("label",{class:"block text-sm font-medium text-gray-700"},"每日次数",-1)),p(s("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=t=>l.value.frequency=t),min:"1",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.frequency,void 0,{number:!0}]])]),s("div",O,[e[13]||(e[13]=s("label",{class:"block text-sm font-medium text-gray-700"},"当前库存",-1)),p(s("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=t=>l.value.stock=t),min:"0",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,l.value.stock,void 0,{number:!0}]])]),s("div",R,[e[14]||(e[14]=s("label",{class:"block text-sm font-medium text-gray-700"},"服药时间",-1)),s("div",G,[(i(!0),r(v,null,h(l.value.times,(t,n)=>(i(),r("div",{key:n},[p(s("input",{type:"time","onUpdate:modelValue":u=>l.value.times[n]=u,required:"",class:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,8,J),[[y,l.value.times[n]]])]))),128))])])]),s("div",K,[s("button",{type:"button",onClick:e[5]||(e[5]=t=>g.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 取消 "),e[15]||(e[15]=s("button",{type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all"}," 确认添加 ",-1))])],32)])],2),s("main",Q,[d.value.length===0?(i(),r("div",W,[...e[17]||(e[17]=[s("i",{"data-lucide":"pilcrow",class:"mx-auto h-12 w-12 text-gray-400"},null,-1),s("h3",{class:"mt-2 text-sm font-medium"},"暂无药品记录",-1)])])):x("",!0),(i(!0),r(v,null,h(d.value,t=>(i(),r("div",{key:t.id,class:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-5 border-l-4 border-blue-500 border-white/20"},[s("div",X,[s("div",Y,[s("h3",Z,c(t.name),1),s("p",ee," 用法: "+c(t.dosage||"未设置")+" / 每次, "+c(t.frequency||"N/A")+"次 / 每日 ",1),t.medication_times?(i(),r("p",se,"时间: "+c(t.medication_times),1)):x("",!0),s("p",te,[e[18]||(e[18]=A(" 库存: ",-1)),s("span",oe,c(t.stock||0),1)])]),s("div",ae,[s("button",{onClick:n=>V(t),class:"flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 服用 ",8,le),s("button",{onClick:n=>q(t),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 记录 ",8,ne),s("button",{onClick:n=>E(t),class:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 补充 ",8,re),s("button",{onClick:n=>M(t),class:"flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md"}," 删除 ",8,ie)])])]))),128))]),w.value?(i(),r("div",{key:0,onClick:e[7]||(e[7]=_(t=>w.value=!1,["self"])),class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[s("div",de,[s("h2",ue,'"'+c(k.value)+'" 的服药历史',1),f.value.length>0?(i(),r("ul",ce,[(i(!0),r(v,null,h(f.value,t=>(i(),r("li",{key:t.id,class:"flex justify-between items-center p-2 bg-gray-100 rounded-md text-sm"},[s("span",null,c(new Date(t.taken_at).toLocaleString("zh-CN")),1),s("button",{onClick:n=>N(t.id),class:"text-red-500 hover:text-red-700 font-semibold text-xs"}," 删除 ",8,me)]))),128))])):(i(),r("p",be,"暂无服药记录")),s("div",ge,[s("button",{onClick:e[6]||(e[6]=t=>w.value=!1),class:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-all"}," 关闭 ")])])])):x("",!0)]))}});export{ye as default};
