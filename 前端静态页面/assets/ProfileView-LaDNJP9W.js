import{d as C,C as q,l as h,r as o,w as B,o as D,c as a,a as e,b as d,t as m,e as P,f as c,v as x,n as _,h as U,j as r}from"./index-BH0FCm0V.js";const T={class:"p-4 md:p-8"},F={class:"max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6"},L={key:0,class:"text-center"},N={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},j={class:"block sm:inline"},z={key:2,class:"flex items-center space-x-4 mb-6"},A=["src"],I={class:"text-xl font-bold text-gray-900"},O={class:"text-sm text-gray-500"},R={key:3},$={class:"space-y-4"},G={class:"mt-6"},H=["disabled"],J={key:4},K={class:"space-y-4"},Q={class:"mt-6"},W=["disabled"],X={key:5,class:"mt-6 p-4 bg-gray-100 rounded-lg"},ee=C({__name:"ProfileView",setup(Y){const g=q(),t=h(()=>g.user),V=o(!1),k=o(""),S=h(()=>t.value?.id?`https://api.dicebear.com/8.x/bottts-neutral/svg?seed=${t.value.id}`:""),u=o({username:"",email:""}),f=o(!1),v=o(""),w=o(!1),n=o({oldPassword:"",newPassword:""}),p=o(!1),b=o(""),y=o(!1);B(t,l=>{l&&(u.value.username=l.username||"",u.value.email=l.email||"")},{immediate:!0});const E=async()=>{f.value=!0,v.value="",w.value=!1;try{const l=await U("/me/profile","PUT",u.value);v.value=l.message,await g.fetchUser()}catch(l){w.value=!0,l instanceof Error?v.value=l.message:v.value="无法连接到服务器。"}finally{f.value=!1}},M=async()=>{p.value=!0,b.value="",y.value=!1;try{const l=await U("/change-password","POST",n.value);b.value=l.message,n.value.oldPassword="",n.value.newPassword=""}catch(l){y.value=!0,l instanceof Error?b.value=l.message:b.value="无法连接到服务器。"}finally{p.value=!1}};return D(()=>{t.value||g.fetchUser()}),(l,s)=>(r(),a("div",T,[e("div",F,[s[13]||(s[13]=e("h1",{class:"text-2xl font-bold text-gray-800 mb-6 border-b pb-4"},"我的账户",-1)),V.value?(r(),a("div",L,[...s[4]||(s[4]=[e("p",null,"正在加载用户信息...",-1)])])):d("",!0),k.value?(r(),a("div",N,[s[5]||(s[5]=e("strong",{class:"font-bold"},"加载失败：",-1)),e("span",j,m(k.value),1)])):d("",!0),t.value?(r(),a("div",z,[e("img",{src:S.value,alt:"User Avatar",class:"h-16 w-16 rounded-full bg-gray-200"},null,8,A),e("div",null,[e("h2",I,m(t.value.username||"未设置用户名"),1),e("p",O,"用户ID: "+m(t.value.id),1)])])):d("",!0),s[14]||(s[14]=e("hr",{class:"my-6"},null,-1)),t.value?(r(),a("div",R,[s[8]||(s[8]=e("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"更新个人信息",-1)),e("form",{onSubmit:P(E,["prevent"])},[e("div",$,[e("div",null,[s[6]||(s[6]=e("label",{for:"username",class:"block text-sm font-medium text-gray-700"},"用户名",-1)),c(e("input",{type:"text",id:"username","onUpdate:modelValue":s[0]||(s[0]=i=>u.value.username=i),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,u.value.username]])]),e("div",null,[s[7]||(s[7]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"邮箱",-1)),c(e("input",{type:"email",id:"email","onUpdate:modelValue":s[1]||(s[1]=i=>u.value.email=i),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,u.value.email]])])]),e("div",G,[e("button",{type:"submit",class:"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all",disabled:f.value},m(f.value?"正在保存...":"保存更改"),9,H)])],32),v.value?(r(),a("p",{key:0,class:_(["mt-2 text-sm",w.value?"text-red-500":"text-green-600"])},m(v.value),3)):d("",!0)])):d("",!0),s[15]||(s[15]=e("hr",{class:"my-6"},null,-1)),t.value&&t.value.has_password?(r(),a("div",J,[s[11]||(s[11]=e("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"更改密码",-1)),e("form",{onSubmit:P(M,["prevent"])},[e("div",K,[e("div",null,[s[9]||(s[9]=e("label",{for:"oldPassword",class:"block text-sm font-medium text-gray-700"},"旧密码",-1)),c(e("input",{type:"password",id:"oldPassword","onUpdate:modelValue":s[2]||(s[2]=i=>n.value.oldPassword=i),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,n.value.oldPassword]])]),e("div",null,[s[10]||(s[10]=e("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700"},"新密码 (至少6位)",-1)),c(e("input",{type:"password",id:"newPassword","onUpdate:modelValue":s[3]||(s[3]=i=>n.value.newPassword=i),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[x,n.value.newPassword]])])]),e("div",Q,[e("button",{type:"submit",class:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all",disabled:p.value},m(p.value?"正在提交...":"确认更改"),9,W)])],32),b.value?(r(),a("p",{key:0,class:_(["mt-2 text-sm",y.value?"text-red-500":"text-green-600"])},m(b.value),3)):d("",!0)])):d("",!0),t.value&&!t.value.has_password?(r(),a("div",X,[...s[12]||(s[12]=[e("p",{class:"text-sm text-gray-700"},"您通过第三方服务 (linux.do) 登录，无需设置或更改密码。",-1)])])):d("",!0)])]))}});export{ee as default};
