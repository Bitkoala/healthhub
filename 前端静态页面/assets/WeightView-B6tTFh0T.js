import{d as G,u as O,r as g,c,o as z,a as r,b as t,e as h,f as B,t as d,q as $,F as A,g as I,h as S,v as D,m as Y,p as J,j as b,k as n}from"./index-Cc27W2Vn.js";import{C as K,p as Q,a as X,b as Z,e as ee,c as te,L as se,P as ae,f as oe}from"./index-BllGej96.js";const le={class:"p-4 sm:p-6 md:p-8 max-w-4xl mx-auto"},re={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},ne={class:"bg-white p-4 rounded-lg shadow-md text-center"},ie={class:"text-2xl font-bold"},de={key:0,class:"text-lg"},ue={class:"bg-white p-4 rounded-lg shadow-md text-center"},ge={class:"text-2xl font-bold"},ce={class:"bg-white p-4 rounded-lg shadow-md text-center"},me={key:0,class:"text-lg"},pe={key:0,class:"bg-white p-6 rounded-lg shadow-md mb-6"},he={class:"text-lg font-semibold mb-4"},ve={class:"space-y-2"},xe={class:"text-gray-700"},be={class:"bg-white p-6 rounded-lg shadow-md"},ye={class:"mb-8"},we={class:"flex flex-wrap items-end gap-4"},fe={class:"flex-grow"},_e={class:"flex-grow"},ke={key:0,class:"flex items-center gap-2 mt-1"},Te={key:1,class:"flex items-center gap-2 h-[42px]"},$e={class:"text-lg"},Se={class:"mb-8"},De={class:"max-h-60 overflow-y-auto border rounded-lg"},Ce={class:"min-w-full divide-y divide-gray-200"},Ee={class:"bg-white divide-y divide-gray-200"},We={key:0},Ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Me=["onClick"],Be={class:"mb-8"},Ae={class:"flex flex-wrap items-end gap-4"},Ie={key:0},Le={class:"text-lg font-semibold mb-4"},Re=G({__name:"WeightView",setup(Ue){K.register(Q,X,Z,ee,te,se,ae);const i=O(),m=g([]),l=g(null),v=g(!1),p=g(null),y=g(""),w=g(""),u=g([]),f=async()=>{try{const a=await b("/weight","GET");m.value=a.weights||[],l.value=a.height||null}catch(a){i.showToast({message:`加载数据失败: ${a instanceof Error?a.message:String(a)}`,type:"error"})}},L=async()=>{if(!p.value||p.value<=0){i.showToast({message:"请输入有效的体重值",type:"error"});return}const a=new Date,e=a.getFullYear(),s=(a.getMonth()+1).toString().padStart(2,"0"),o=a.getDate().toString().padStart(2,"0"),x=a.getHours().toString().padStart(2,"0"),V=a.getMinutes().toString().padStart(2,"0"),N=a.getSeconds().toString().padStart(2,"0"),q=`${e}-${s}-${o} ${x}:${V}:${N}`;try{await b("/weight","POST",{weight:p.value,log_datetime:q}),i.showToast({message:"体重已保存",type:"success"}),p.value=null,await f()}catch(F){i.showToast({message:`保存失败: ${F instanceof Error?F.message:String(F)}`,type:"error"})}},U=async()=>{if(!l.value||l.value<=0){i.showToast({message:"请输入有效的身高值",type:"error"});return}try{await b("/weight/height","PUT",{height:l.value}),i.showToast({message:"身高已保存",type:"success"}),v.value=!1,await f()}catch(a){i.showToast({message:`保存失败: ${a instanceof Error?a.message:String(a)}`,type:"error"})}},H=async a=>{const e=_.value.find(s=>s.id===a);if(e&&confirm(`确定要删除 ${C(e.log_datetime)} 的体重记录吗？`))try{await b(`/weight/${a}`,"DELETE"),i.showToast({message:"记录已删除",type:"success"}),await f();const s=u.value.findIndex(o=>o.id===a);s>-1&&u.value.splice(s,1)}catch(s){i.showToast({message:`删除失败: ${s instanceof Error?s.message:String(s)}`,type:"error"})}},P=async()=>{if(!y.value||!w.value){i.showToast({message:"请选择开始和结束时间",type:"error"});return}try{const a=y.value.replace("T"," ")+":00",e=w.value.replace("T"," ")+":59",s=await b(`/weight/history?start_datetime=${a}&end_datetime=${e}`,"GET");u.value=s,s.length===0&&i.showToast({message:"该时间段内没有记录",type:"success"})}catch(a){i.showToast({message:`查询历史记录失败: ${a instanceof Error?a.message:String(a)}`,type:"error"})}},_=c(()=>[...m.value].reverse()),k=c(()=>_.value.length>0?_.value[0].weight:null),T=c(()=>{if(!k.value||!l.value)return{value:null,label:"信息不全",color:"text-gray-500"};const a=k.value/(l.value/100)**2,e=parseFloat(a.toFixed(1));let s="",o="";return e<18.5?(s="体重过轻",o="text-blue-500"):e>=18.5&&e<24?(s="健康体重",o="text-green-500"):e>=24&&e<28?(s="超重",o="text-yellow-500"):(s="肥胖",o="text-red-500"),{value:e,label:s,color:o}}),C=a=>a?a.substring(0,16).replace("T"," "):"N/A",E=c(()=>{if(m.value.length<2)return{value:"N/A",color:"text-gray-900"};const a=[...m.value].sort((V,N)=>new Date(V.log_datetime).getTime()-new Date(N.log_datetime).getTime()),e=a[0].weight,s=a[a.length-1].weight,o=parseFloat((s-e).toFixed(1));let x="text-gray-500";return o>0&&(x="text-red-500"),o<0&&(x="text-green-500"),{value:o>0?`+${o}`:`${o}`,color:x}}),R=c(()=>u.value.length>0?"历史体重走势":"最近体重趋势"),W=c(()=>{const e=[...u.value.length>0?u.value:m.value].sort((s,o)=>new Date(s.log_datetime).getTime()-new Date(o.log_datetime).getTime());return{labels:e.map(s=>C(s.log_datetime)),datasets:[{label:"体重 (kg)",backgroundColor:u.value.length>0?"#8b5cf6":"#3b82f6",borderColor:u.value.length>0?"#8b5cf6":"#3b82f6",data:e.map(s=>s.weight),tension:.1}]}}),j={responsive:!0,maintainAspectRatio:!0},M=c(()=>{if(!l.value)return null;const a=l.value/100,e=s=>(s*a*a).toFixed(1);return[{label:"体重过轻",range:`< ${e(18.5)} kg`,color:"text-blue-500"},{label:"健康体重",range:`${e(18.5)} - ${e(23.9)} kg`,color:"text-green-500"},{label:"超重",range:`${e(24)} - ${e(27.9)} kg`,color:"text-yellow-500"},{label:"肥胖",range:`≥ ${e(28)} kg`,color:"text-red-500"}]});return z(f),(a,e)=>(n(),r("div",le,[e[19]||(e[19]=t("div",{class:"inline-block bg-white/80 backdrop-blur-sm px-6 py-3 rounded-xl shadow mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800"},"体重管理")],-1)),t("div",re,[t("div",ne,[e[6]||(e[6]=t("h3",{class:"text-sm font-medium text-gray-500"},"当前体重",-1)),t("p",ie,[B(d(k.value||"N/A")+" ",1),k.value?(n(),r("span",de,"kg")):h("",!0)])]),t("div",ue,[e[7]||(e[7]=t("h3",{class:"text-sm font-medium text-gray-500"},"BMI 指数",-1)),t("p",ge,d(T.value.value||"N/A"),1),t("p",{class:$([T.value.color,"text-sm font-semibold"])},d(T.value.label),3)]),t("div",ce,[e[8]||(e[8]=t("h3",{class:"text-sm font-medium text-gray-500"},"体重变化",-1)),t("p",{class:$(["text-2xl font-bold",E.value.color])},[B(d(E.value.value)+" ",1),E.value.value!=="N/A"?(n(),r("span",me,"kg")):h("",!0)],2)])]),l.value&&M.value?(n(),r("div",pe,[t("h3",he,"BMI 体重范围参考 (基于您 "+d(l.value)+"cm 的身高)",1),t("ul",ve,[(n(!0),r(A,null,I(M.value,s=>(n(),r("li",{key:s.label,class:$(["flex justify-between items-center p-2 rounded-md",T.value.label===s.label?"bg-blue-50":""])},[t("span",{class:$(["font-semibold",s.color])},d(s.label),3),t("span",xe,d(s.range),1)],2))),128))]),e[9]||(e[9]=t("p",{class:"text-xs text-gray-500 mt-4"},"*BMI分类标准参考中国标准。",-1))])):h("",!0),t("div",be,[t("div",ye,[e[12]||(e[12]=t("h3",{class:"text-lg font-semibold mb-4"},"记录新数据",-1)),t("div",we,[t("div",fe,[e[10]||(e[10]=t("label",{for:"weight-input",class:"block text-sm font-medium text-gray-700"},"今日体重 (kg)",-1)),S(t("input",{type:"number",id:"weight-input","onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),placeholder:"例如: 65.5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[D,p.value,void 0,{number:!0}]])]),t("button",{onClick:L,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"保存体重"),t("div",_e,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"身高 (cm)",-1)),!l.value||v.value?(n(),r("div",ke,[S(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),placeholder:"例如: 175",class:"block w-full rounded-md border-gray-300 shadow-sm sm:text-sm"},null,512),[[D,l.value,void 0,{number:!0}]]),t("button",{onClick:U,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 whitespace-nowrap"},"保存"),v.value?(n(),r("button",{key:0,onClick:e[2]||(e[2]=s=>v.value=!1),class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 whitespace-nowrap"},"取消")):h("",!0)])):(n(),r("div",Te,[t("p",$e,d(l.value)+" cm",1),t("button",{onClick:e[3]||(e[3]=s=>v.value=!0),class:"text-sm text-blue-600 hover:underline"},"修改")]))])])]),t("div",Se,[e[15]||(e[15]=t("h3",{class:"text-lg font-semibold mb-4"},"最近 15 条记录",-1)),t("div",De,[t("table",Ce,[e[14]||(e[14]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"日期时间"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"体重 (kg)"),t("th",{scope:"col",class:"relative px-6 py-3"},[t("span",{class:"sr-only"},"删除")])])],-1)),t("tbody",Ee,[m.value.length===0?(n(),r("tr",We,[...e[13]||(e[13]=[t("td",{colspan:"3",class:"px-6 py-4 text-center text-gray-500"},"暂无记录",-1)])])):h("",!0),(n(!0),r(A,null,I(_.value,s=>(n(),r("tr",{key:s.id},[t("td",Ve,d(C(s.log_datetime)),1),t("td",Ne,d(s.weight),1),t("td",Fe,[t("button",{onClick:o=>H(s.id),class:"text-red-600 hover:text-red-900"},"删除",8,Me)])]))),128))])])])]),t("div",Be,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold mb-4"},"历史记录查询",-1)),t("div",Ae,[t("div",null,[e[16]||(e[16]=t("label",{for:"start-date",class:"block text-sm font-medium text-gray-700"},"开始时间",-1)),S(t("input",{type:"datetime-local",id:"start-date","onUpdate:modelValue":e[4]||(e[4]=s=>y.value=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[D,y.value]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"end-date",class:"block text-sm font-medium text-gray-700"},"结束时间",-1)),S(t("input",{type:"datetime-local",id:"end-date","onUpdate:modelValue":e[5]||(e[5]=s=>w.value=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[D,w.value]])]),t("button",{onClick:P,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"},"查询")])]),W.value.labels&&W.value.labels.length>1?(n(),r("div",Ie,[t("h3",Le,d(R.value),1),Y(J(oe),{data:W.value,options:j},null,8,["data"])])):h("",!0)])]))}});export{Re as default};
