import{d as j,B as q,y as B,r as i,c as M,w as $,a as u,b as e,e as f,t as l,p as o,q as x,i as k,h as v,v as h,C as F,j as P,k as c}from"./index-CdF3FHW1.js";const L={class:"px-2 md:px-6 py-4 md:py-12 mobile-px-0 relative"},T={class:"max-w-3xl mx-auto space-y-6 md:space-y-8"},D={class:"animate-fade-in text-center space-y-3 md:space-y-4 mb-6 md:mb-12"},H={class:"inline-block relative"},N={class:"relative w-20 h-20 md:w-24 md:h-24 mx-auto mb-4 rounded-full overflow-hidden border-2 border-white/20 shadow-2xl bg-gray-100"},R=["src"],W={key:1,class:"w-full h-full flex items-center justify-center bg-gray-200"},z={class:"relative text-2xl md:text-5xl font-black text-on-surface tracking-tighter"},A={class:"text-on-surface-variant font-medium tracking-wide uppercase text-[10px] md:text-xs opacity-60"},G={class:"glass-card overflow-hidden animate-card-in",style:{"animation-delay":"0.1s"}},I={class:"p-4 md:p-8 space-y-6 md:space-y-10"},J={class:"space-y-4 md:space-y-6"},K={class:"flex items-center justify-between p-3 md:p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-sm transition-all hover:bg-white/10"},O={class:"flex-shrink-0"},Q=["aria-checked"],X={class:"space-y-4 md:space-y-6"},Y={class:"space-y-2"},Z={class:"relative group"},ee={class:"space-y-2"},se={class:"relative group"},te={class:"md:col-span-2 pt-2 md:pt-4"},ae=["disabled"],oe={class:"space-y-4 md:space-y-6"},le={class:"flex items-center space-x-3"},re={class:"text-xs md:text-sm font-bold uppercase tracking-widest text-on-surface/80"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},ie={key:0,class:"space-y-2"},de=["disabled"],ue={class:"pt-6 md:pt-8 flex flex-col items-center border-t border-white/10"},ce={class:"text-sm uppercase tracking-[0.2em]"},fe=j({__name:"ProfileView",setup(pe){const t=q(),U=F(),r=B({username:t.user?.username||"",email:t.user?.email||""}),w=i(!1),p=i(""),g=i(!1),d=i({oldPassword:"",newPassword:""}),b=i(!1),m=i(""),y=i(!1),_=M(()=>t.user?.id?`https://api.dicebear.com/8.x/bottts-neutral/svg?seed=${t.user.id}`:"");$(()=>t.user,a=>{a&&(r.username=a.username||"",r.email=a.email||"")},{immediate:!0});const S=async()=>{w.value=!0,p.value="",g.value=!1;try{const a=await P("/auth/me","PUT",r);t.setUser(a),p.value="个人资料更新成功！"}catch(a){g.value=!0,p.value=a instanceof Error?`更新失败: ${a.message}`:"更新时发生未知错误"}finally{w.value=!1}},V=async()=>{b.value=!0,m.value="",y.value=!1;try{await P("/auth/me/password","PUT",d.value),m.value="密码更新成功！",d.value={oldPassword:"",newPassword:""}}catch(a){y.value=!0,m.value=a instanceof Error?`密码修改失败: ${a.message}`:"修改密码时发生未知错误"}finally{b.value=!1}},C=()=>{t.logout(),U.push({name:"login"})},E=async()=>{if(t.user)try{const a=!!t.user.show_womens_health;await t.updateShowWomensHealth(!a)}catch(a){console.error("Failed to update setting:",a)}};return(a,s)=>(c(),u("div",L,[e("div",T,[e("div",D,[e("div",H,[s[5]||(s[5]=e("div",{class:"absolute -inset-6 bg-gradient-to-r from-blue-500/20 to-purple-500/20 blur-2xl rounded-full opacity-50"},null,-1)),e("div",N,[_.value?(c(),u("img",{key:0,src:_.value,alt:"User",class:"w-full h-full object-cover"},null,8,R)):f("",!0),_.value?f("",!0):(c(),u("div",W,[...s[4]||(s[4]=[e("i",{"data-lucide":"user",class:"w-10 h-10 md:w-12 md:h-12 text-gray-400"},null,-1)])]))]),e("h1",z,l(o(t).user?.username),1)]),e("p",A,l(o(t).user?.email),1)]),e("div",G,[e("div",I,[e("section",J,[s[7]||(s[7]=e("div",{class:"flex items-center space-x-3"},[e("i",{"data-lucide":"settings",class:"w-4 h-4 md:w-5 md:h-5 text-blue-500/60"}),e("h3",{class:"text-xs md:text-sm font-bold uppercase tracking-widest text-on-surface/80"},"应用偏好")],-1)),e("div",K,[s[6]||(s[6]=e("div",{class:"flex-grow min-w-0 pr-2"},[e("div",{class:"text-sm font-bold text-on-surface"},"显示女性健康模块"),e("p",{class:"text-[10px] text-on-surface-variant/60 uppercase tracking-tight leading-tight"},"控制主页显示经期追踪")],-1)),e("div",O,[e("button",{onClick:E,role:"switch","aria-checked":o(t).user?.show_womens_health,class:x(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none",o(t).user?.show_womens_health?"bg-blue-600":"bg-white/10"])},[e("span",{"aria-hidden":"true",class:x(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-lg ring-0 transition duration-300 ease-in-out",o(t).user?.show_womens_health?"translate-x-5":"translate-x-0"])},null,2)],10,Q)])])]),s[17]||(s[17]=e("div",{class:"h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent"},null,-1)),e("section",X,[s[12]||(s[12]=e("div",{class:"flex items-center space-x-3"},[e("i",{"data-lucide":"user",class:"w-4 h-4 md:w-5 md:h-5 text-blue-500/60"}),e("h3",{class:"text-xs md:text-sm font-bold uppercase tracking-widest text-on-surface/80"},"账号资料")],-1)),e("form",{onSubmit:k(S,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},[e("div",Y,[s[9]||(s[9]=e("label",{for:"username",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"用户名",-1)),e("div",Z,[s[8]||(s[8]=e("i",{"data-lucide":"at-sign",class:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-on-surface-variant/40 group-focus-within:text-blue-500 transition-colors"},null,-1)),v(e("input",{type:"text",id:"username","onUpdate:modelValue":s[0]||(s[0]=n=>r.username=n),class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 pl-12 pr-4 text-sm text-on-surface placeholder:text-on-surface-variant/20 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/40 transition-all"},null,512),[[h,r.username]])])]),e("div",ee,[s[11]||(s[11]=e("label",{for:"email",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"电子邮箱",-1)),e("div",se,[s[10]||(s[10]=e("i",{"data-lucide":"mail",class:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-on-surface-variant/40 group-focus-within:text-blue-500 transition-colors"},null,-1)),v(e("input",{type:"email",id:"email","onUpdate:modelValue":s[1]||(s[1]=n=>r.email=n),class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 pl-12 pr-4 text-sm text-on-surface placeholder:text-on-surface-variant/20 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500/40 transition-all"},null,512),[[h,r.email]])])]),e("div",te,[e("button",{type:"submit",disabled:w.value,class:"w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-2xl shadow-xl shadow-blue-500/20 hover:shadow-blue-500/40 active:scale-[0.98] transition-all disabled:opacity-50 disabled:grayscale"},l(w.value?"同步中...":"提交更改"),9,ae)])],32),p.value?(c(),u("p",{key:0,class:x(["text-center text-xs font-bold mt-4",g.value?"text-red-400":"text-emerald-400"])},l(p.value),3)):f("",!0)]),s[18]||(s[18]=e("div",{class:"h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent my-6 md:my-10"},null,-1)),e("section",oe,[e("div",le,[s[13]||(s[13]=e("i",{"data-lucide":"lock",class:"w-4 h-4 md:w-5 md:h-5 text-amber-500/60"},null,-1)),e("h3",re,l(o(t).user?.has_password?"修改安全密码":"设置本地登录密码"),1)]),e("form",{onSubmit:k(V,["prevent"]),class:"space-y-4 md:space-y-6"},[e("div",ne,[o(t).user?.has_password?(c(),u("div",ie,[s[14]||(s[14]=e("label",{for:"oldPassword",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"当前密码",-1)),v(e("input",{type:"password",id:"oldPassword","onUpdate:modelValue":s[2]||(s[2]=n=>d.value.oldPassword=n),required:"",class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 px-4 text-sm text-on-surface focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"},null,512),[[h,d.value.oldPassword]])])):f("",!0),e("div",{class:x(["space-y-2",o(t).user?.has_password?"":"md:col-span-2"])},[s[15]||(s[15]=e("label",{for:"newPassword",class:"text-[10px] font-bold uppercase tracking-widest text-on-surface-variant/60 ml-1"},"新密码",-1)),v(e("input",{type:"password",id:"newPassword","onUpdate:modelValue":s[3]||(s[3]=n=>d.value.newPassword=n),required:"",class:"w-full bg-white/5 border border-white/10 rounded-2xl py-3 px-4 text-sm text-on-surface focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all"},null,512),[[h,d.value.newPassword]])],2)]),e("button",{type:"submit",disabled:b.value,class:"w-full py-4 border border-blue-500/30 text-blue-500 bg-blue-500/5 hover:bg-blue-500/10 font-bold rounded-2xl transition-all active:scale-[0.98]"},l(b.value?"正在验证...":o(t).user?.has_password?"更新安全凭证":"保存本地密码"),9,de)],32),m.value?(c(),u("p",{key:0,class:x(["text-center text-xs font-bold",y.value?"text-red-400":"text-emerald-400"])},l(m.value),3)):f("",!0)]),e("div",ue,[e("button",{onClick:C,class:"group flex items-center space-x-3 text-red-500/60 hover:text-red-500 font-bold transition-all p-2"},[s[16]||(s[16]=e("i",{"data-lucide":"log-out",class:"w-5 h-5 group-hover:-translate-x-1 transition-transform"},null,-1)),e("span",ce,l(a.$t("logout")),1)])])])])])]))}});export{fe as default};
