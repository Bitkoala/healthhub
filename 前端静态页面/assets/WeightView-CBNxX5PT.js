import{d as I,u as G,r as m,l as h,o as O,c as i,a as e,k as N,b as _,t as d,n as F,f as k,v as T,F as R,g as j,B as q,x as z,h as v,j as u}from"./index-BH0FCm0V.js";import{C as Y,p as J,a as K,b as Q,e as X,c as Z,L as tt,P as et,f as st}from"./index-BB5w7W8k.js";const ot={class:"p-4 sm:p-6 md:p-8 max-w-4xl mx-auto"},at={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},lt={class:"bg-white p-4 rounded-lg shadow-md text-center"},rt={class:"text-2xl font-bold"},nt={key:0,class:"text-lg"},it={class:"bg-white p-4 rounded-lg shadow-md text-center"},dt={class:"text-2xl font-bold"},ut={class:"bg-white p-4 rounded-lg shadow-md text-center"},gt={key:0,class:"text-lg"},ct={class:"bg-white p-6 rounded-lg shadow-md"},mt={class:"mb-8"},ht={class:"flex flex-wrap items-end gap-4"},pt={class:"flex-grow"},vt={class:"flex-grow"},xt={class:"mb-8"},bt={class:"max-h-60 overflow-y-auto border rounded-lg"},wt={class:"min-w-full divide-y divide-gray-200"},ft={class:"bg-white divide-y divide-gray-200"},yt={key:0},_t={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Tt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},St=["onClick"],Dt={class:"mb-8"},$t={class:"flex flex-wrap items-end gap-4"},Ct={key:0},Et={class:"text-lg font-semibold mb-4"},Ft=I({__name:"WeightView",setup(Vt){Y.register(J,K,Q,X,Z,tt,et);const l=G(),g=m([]),r=m(null),c=m(null),x=m(""),b=m(""),n=m([]),w=async()=>{try{const o=await v("/weight","GET");g.value=o.weights||[],r.value=o.height||null}catch(o){l.showToast({message:`加载数据失败: ${o instanceof Error?o.message:String(o)}`,type:"error"})}},A=async()=>{if(!c.value||c.value<=0){l.showToast({message:"请输入有效的体重值",type:"error"});return}const o=new Date,t=o.getFullYear(),s=(o.getMonth()+1).toString().padStart(2,"0"),a=o.getDate().toString().padStart(2,"0"),p=o.getHours().toString().padStart(2,"0"),E=o.getMinutes().toString().padStart(2,"0"),V=o.getSeconds().toString().padStart(2,"0"),H=`${t}-${s}-${a} ${p}:${E}:${V}`;try{await v("/weight","POST",{weight:c.value,log_datetime:H}),l.showToast({message:"体重已保存",type:"success"}),c.value=null,await w()}catch(W){l.showToast({message:`保存失败: ${W instanceof Error?W.message:String(W)}`,type:"error"})}},B=async()=>{if(!r.value||r.value<=0){l.showToast({message:"请输入有效的身高值",type:"error"});return}try{await v("/weight/height","PUT",{height:r.value}),l.showToast({message:"身高已更新",type:"success"}),await w()}catch(o){l.showToast({message:`更新失败: ${o instanceof Error?o.message:String(o)}`,type:"error"})}},L=async o=>{const t=f.value.find(s=>s.id===o);if(t&&confirm(`确定要删除 ${D(t.log_datetime)} 的体重记录吗？`))try{await v(`/weight/${o}`,"DELETE"),l.showToast({message:"记录已删除",type:"success"}),await w();const s=n.value.findIndex(a=>a.id===o);s>-1&&n.value.splice(s,1)}catch(s){l.showToast({message:`删除失败: ${s instanceof Error?s.message:String(s)}`,type:"error"})}},M=async()=>{if(!x.value||!b.value){l.showToast({message:"请选择开始和结束时间",type:"error"});return}try{const o=x.value.replace("T"," ")+":00",t=b.value.replace("T"," ")+":59",s=await v(`/weight/history?start_datetime=${o}&end_datetime=${t}`,"GET");n.value=s,s.length===0&&l.showToast({message:"该时间段内没有记录",type:"success"})}catch(o){l.showToast({message:`查询历史记录失败: ${o instanceof Error?o.message:String(o)}`,type:"error"})}},f=h(()=>[...g.value].reverse()),y=h(()=>f.value.length>0?f.value[0].weight:null),S=h(()=>{if(!y.value||!r.value)return{value:null,label:"信息不全",color:"text-gray-500"};const o=y.value/(r.value/100)**2,t=parseFloat(o.toFixed(1));let s="",a="";return t<18.5?(s="偏瘦",a="text-blue-500"):t>=18.5&&t<24?(s="正常",a="text-green-500"):t>=24&&t<28?(s="超重",a="text-yellow-500"):(s="肥胖",a="text-red-500"),{value:t,label:s,color:a}}),D=o=>o?o.substring(0,16).replace("T"," "):"N/A",$=h(()=>{if(g.value.length<2)return{value:"N/A",color:"text-gray-900"};const o=[...g.value].sort((E,V)=>new Date(E.log_datetime).getTime()-new Date(V.log_datetime).getTime()),t=o[0].weight,s=o[o.length-1].weight,a=parseFloat((s-t).toFixed(1));let p="text-gray-500";return a>0&&(p="text-red-500"),a<0&&(p="text-green-500"),{value:a>0?`+${a}`:`${a}`,color:p}}),U=h(()=>n.value.length>0?"历史体重走势":"最近体重趋势"),C=h(()=>{const t=[...n.value.length>0?n.value:g.value].sort((s,a)=>new Date(s.log_datetime).getTime()-new Date(a.log_datetime).getTime());return{labels:t.map(s=>D(s.log_datetime)),datasets:[{label:"体重 (kg)",backgroundColor:n.value.length>0?"#8b5cf6":"#3b82f6",borderColor:n.value.length>0?"#8b5cf6":"#3b82f6",data:t.map(s=>s.weight),tension:.1}]}}),P={responsive:!0,maintainAspectRatio:!0};return O(w),(o,t)=>(u(),i("div",ot,[t[16]||(t[16]=e("div",{class:"inline-block bg-white/80 backdrop-blur-sm px-6 py-3 rounded-xl shadow mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-800"},"体重管理")],-1)),e("div",at,[e("div",lt,[t[4]||(t[4]=e("h3",{class:"text-sm font-medium text-gray-500"},"当前体重",-1)),e("p",rt,[N(d(y.value||"N/A")+" ",1),y.value?(u(),i("span",nt,"kg")):_("",!0)])]),e("div",it,[t[5]||(t[5]=e("h3",{class:"text-sm font-medium text-gray-500"},"BMI 指数",-1)),e("p",dt,d(S.value.value||"N/A"),1),e("p",{class:F([S.value.color,"text-sm font-semibold"])},d(S.value.label),3)]),e("div",ut,[t[6]||(t[6]=e("h3",{class:"text-sm font-medium text-gray-500"},"体重变化",-1)),e("p",{class:F(["text-2xl font-bold",$.value.color])},[N(d($.value.value)+" ",1),$.value.value!=="N/A"?(u(),i("span",gt,"kg")):_("",!0)],2)])]),e("div",ct,[e("div",mt,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold mb-4"},"记录新数据",-1)),e("div",ht,[e("div",pt,[t[7]||(t[7]=e("label",{for:"weight-input",class:"block text-sm font-medium text-gray-700"},"今日体重 (kg)",-1)),k(e("input",{type:"number",id:"weight-input","onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),placeholder:"例如: 65.5",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[T,c.value,void 0,{number:!0}]])]),e("button",{onClick:A,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},"保存体重"),e("div",vt,[t[8]||(t[8]=e("label",{for:"height-input",class:"block text-sm font-medium text-gray-700"},"身高 (cm)",-1)),k(e("input",{type:"number",id:"height-input","onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),placeholder:"例如: 175",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[T,r.value,void 0,{number:!0}]])]),e("button",{onClick:B,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"},"更新身高")])]),e("div",xt,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold mb-4"},"最近 15 条记录",-1)),e("div",bt,[e("table",wt,[t[11]||(t[11]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"日期时间"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"体重 (kg)"),e("th",{scope:"col",class:"relative px-6 py-3"},[e("span",{class:"sr-only"},"删除")])])],-1)),e("tbody",ft,[g.value.length===0?(u(),i("tr",yt,[...t[10]||(t[10]=[e("td",{colspan:"3",class:"px-6 py-4 text-center text-gray-500"},"暂无记录",-1)])])):_("",!0),(u(!0),i(R,null,j(f.value,s=>(u(),i("tr",{key:s.id},[e("td",_t,d(D(s.log_datetime)),1),e("td",kt,d(s.weight),1),e("td",Tt,[e("button",{onClick:a=>L(s.id),class:"text-red-600 hover:text-red-900"},"删除",8,St)])]))),128))])])])]),e("div",Dt,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold mb-4"},"历史记录查询",-1)),e("div",$t,[e("div",null,[t[13]||(t[13]=e("label",{for:"start-date",class:"block text-sm font-medium text-gray-700"},"开始时间",-1)),k(e("input",{type:"datetime-local",id:"start-date","onUpdate:modelValue":t[2]||(t[2]=s=>x.value=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[T,x.value]])]),e("div",null,[t[14]||(t[14]=e("label",{for:"end-date",class:"block text-sm font-medium text-gray-700"},"结束时间",-1)),k(e("input",{type:"datetime-local",id:"end-date","onUpdate:modelValue":t[3]||(t[3]=s=>b.value=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm"},null,512),[[T,b.value]])]),e("button",{onClick:M,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"},"查询")])]),C.value.labels&&C.value.labels.length>1?(u(),i("div",Ct,[e("h3",Et,d(U.value),1),q(z(st),{data:C.value,options:P},null,8,["data"])])):_("",!0)])]))}});export{Ft as default};
