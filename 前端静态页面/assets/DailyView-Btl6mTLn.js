import{d as N,r,u as R,c as E,o as K,w as O,a,b as t,e as u,t as c,i as z,h as w,v as A,l as H,F as v,g as D,s as Q,j as y,q as L,f as P,k as l,n as G}from"./index-Dl9U5HsD.js";const J={class:"container mx-auto p-4 md:p-6 max-w-4xl"},W={class:"space-y-6"},X={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},Y={class:"flex justify-between items-center"},Z={key:0,class:"mt-4 border-t pt-4"},ee={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},te={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4"},se={key:0},oe={class:"space-y-2"},ae={class:"flex items-center gap-2"},le=["onClick"],ne=["onClick"],re=["onClick"],ie=["onClick"],de={key:1,class:"mt-4"},ue={class:"space-y-2"},ce={class:"flex items-center gap-2"},me={key:0,class:"text-sm font-semibold text-green-600"},ye=["onClick"],pe=["onClick"],ge={key:2,class:"text-center py-8 text-gray-500"},be={class:"bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},xe={class:"flex gap-2"},ve={key:0,class:"text-center py-4"},he={key:1,class:"mt-4 space-y-2"},fe={class:"font-semibold"},we={key:0,class:"text-xs text-gray-500 mt-1 pl-2 border-l-2"},_e={key:2,class:"mt-4 text-center text-gray-500"},$e=N({__name:"DailyView",setup(ke){const _=r(!0),m=r(!1),i=r([]),g=r({}),p=r(new Date().toISOString().split("T")[0]),b=r(""),k=r("daily"),h=r(""),x=r([]),f=r(!1),V=r(!1),n=R(),T=E(()=>(Array.isArray(i.value)?i.value:[]).filter(o=>o.item_type==="daily")),$=E(()=>(Array.isArray(i.value)?i.value:[]).filter(o=>o.item_type==="one-time")),U=async()=>{_.value=!0;try{await Promise.all([q(),C(p.value)])}catch(o){n.showToast({message:`加载初始数据失败: ${o.message}`,type:"error"})}finally{_.value=!1}},q=async()=>{try{const o=await y("/daily-logs/items");i.value=Array.isArray(o)?o:[]}catch(o){n.showToast({message:`获取清单项目失败: ${o.message}`,type:"error"}),i.value=[]}},C=async o=>{try{const e=await y(`/daily-logs/logs/${o}`);g.value=(Array.isArray(e)?e:[]).reduce((s,d)=>(s[d.item_name]=d,s),{})}catch(e){n.showToast({message:`获取当日记录失败: ${e.message}`,type:"error"}),g.value={}}},S=o=>g.value[o]?.status||"pending",I=async(o,e)=>{const s={log_date:p.value,item_name:o,status:e,notes:g.value[o]?.notes||""};try{await y("/daily-logs/logs","POST",s),await C(p.value)}catch(d){n.showToast({message:`更新状态失败: ${d.message}`,type:"error"})}},B=async o=>{try{await y(`/daily-logs/items/${o.id}/complete`,"PUT"),n.showToast({message:`任务 "${o.item_name}" 已完成!`,type:"success"});const e=i.value.findIndex(s=>s.id===o.id);e!==-1&&(i.value[e].status="completed")}catch(e){n.showToast({message:`操作失败: ${e.message}`,type:"error"})}},F=async()=>{if(!b.value.trim()){n.showToast({message:"任务名称不能为空",type:"error"});return}try{const o={item_name:b.value.trim(),item_type:k.value},e=await y("/daily-logs/items","POST",o);i.value.push(e),b.value="",n.showToast({message:"新任务已添加",type:"success"})}catch(o){n.showToast({message:`添加失败: ${o.message}`,type:"error"})}},j=async o=>{if(confirm(`确定要删除任务 "${o.item_name}" 吗？
这将同时删除所有相关的历史记录。`))try{await y(`/daily-logs/items/${o.id}`,"DELETE"),await U(),n.showToast({message:"任务已删除",type:"success"})}catch(e){n.showToast({message:`删除失败: ${e.message}`,type:"error"})}},M=async()=>{if(h.value.trim()){f.value=!0,V.value=!0;try{const o=await y(`/daily-logs/history/search?q=${encodeURIComponent(h.value.trim())}`);x.value=Array.isArray(o)?o:[]}catch(o){n.showToast({message:`搜索失败: ${o.message}`,type:"error"}),x.value=[]}finally{f.value=!1}}};return K(()=>{U()}),O(p,o=>{C(o)}),O([m,i,g],()=>{G(()=>{typeof lucide<"u"&&lucide.createIcons()})},{deep:!0}),(o,e)=>(l(),a("div",J,[e[15]||(e[15]=t("header",{class:"mb-6"},[t("div",{class:"inline-block bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow"},[t("h1",{class:"text-2xl font-bold"},"每日清单"),t("p",{class:"text-gray-500 mt-1"},"追踪您的每日习惯与一次性任务")])],-1)),t("main",W,[t("div",X,[t("div",Y,[e[5]||(e[5]=t("h2",{class:"text-xl font-semibold"},"任务管理",-1)),t("button",{onClick:e[0]||(e[0]=s=>m.value=!m.value),class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all text-sm"},c(m.value?"完成":"添加 / 管理"),1)]),m.value?(l(),a("div",Z,[t("form",{onSubmit:z(F,["prevent"]),class:"flex flex-col sm:flex-row gap-2 mb-4"},[w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s),type:"text",placeholder:"输入新任务名称...",class:"flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[A,b.value]]),w(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),class:"px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[...e[6]||(e[6]=[t("option",{value:"daily"},"每日任务",-1),t("option",{value:"one-time"},"一次性任务",-1)])],512),[[H,k.value]]),e[7]||(e[7]=t("button",{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all"}," 添加 ",-1))],32)])):u("",!0)]),t("div",ee,[t("div",te,[e[8]||(e[8]=t("h2",{class:"text-xl font-semibold"},"今日任务",-1)),w(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>p.value=s),class:"px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[A,p.value]])]),T.value.length>0?(l(),a("div",se,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-2 text-gray-700"},"每日任务",-1)),t("ul",oe,[(l(!0),a(v,null,D(T.value,s=>(l(),a("li",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},[t("span",null,c(s.item_name),1),t("div",ae,[S(s.item_name)==="pending"?(l(),a(v,{key:0},[t("button",{onClick:d=>I(s.item_name,"completed"),class:"text-xs bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 完成 ",8,le),t("button",{onClick:d=>I(s.item_name,"skipped"),class:"text-xs bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 跳过 ",8,ne)],64)):(l(),a(v,{key:1},[t("span",{class:L([S(s.item_name)==="completed"?"text-green-600":"text-yellow-600","text-sm font-semibold"])},c(S(s.item_name)==="completed"?"今日已完成":"今日已跳过"),3),t("button",{onClick:d=>I(s.item_name,"pending"),class:"text-xs text-gray-500 hover:text-gray-700"}," 撤销 ",8,re)],64)),m.value?(l(),a("button",{key:2,onClick:d=>j(s),class:"text-xs bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-2 rounded-full transition-all"}," 删除 ",8,ie)):u("",!0)])]))),128))])])):u("",!0),$.value.length>0?(l(),a("div",de,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold mb-2 text-gray-700"},"一次性任务",-1)),t("ul",ue,[(l(!0),a(v,null,D($.value,s=>(l(),a("li",{key:s.id,class:"flex justify-between items-center p-3 bg-gray-50 rounded-lg"},[t("span",{class:L({"line-through text-gray-400":s.status==="completed"})},c(s.item_name),3),t("div",ce,[s.status==="completed"?(l(),a("span",me,"已完成")):(l(),a("button",{key:1,onClick:d=>B(s),class:"text-xs bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded-full transition-all"}," 完成 ",8,ye)),m.value?(l(),a("button",{key:2,onClick:d=>j(s),class:"text-xs bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-2 rounded-full transition-all"}," 删除 ",8,pe)):u("",!0)])]))),128))])])):u("",!0),!_.value&&T.value.length===0&&$.value.length===0?(l(),a("div",ge,[...e[11]||(e[11]=[t("p",null,"暂无任务项目。",-1),t("p",null,'点击 "添加 / 管理" 来创建您的第一个任务吧！',-1)])])):u("",!0)]),t("div",be,[e[14]||(e[14]=t("h2",{class:"text-xl font-semibold mb-4"},"历史记录查询",-1)),t("div",xe,[w(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),onKeyup:Q(M,["enter"]),placeholder:"输入关键词搜索历史...",class:"flex-grow px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,544),[[A,h.value]]),t("button",{onClick:M,class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-all"}," 搜索 ")]),f.value?(l(),a("div",ve,"正在搜索...")):u("",!0),x.value.length>0?(l(),a("ul",he,[(l(!0),a(v,null,D(x.value,s=>(l(),a("li",{key:s.id,class:"p-3 bg-gray-50 rounded-lg text-sm"},[t("span",fe,c(new Date(s.log_date).toLocaleDateString()),1),e[12]||(e[12]=P(" - ",-1)),t("span",null,c(s.item_name),1),e[13]||(e[13]=P(": ",-1)),t("span",{class:L(["font-medium",s.status==="completed"?"text-green-600":"text-yellow-600"])},c(s.status==="completed"?"已完成":"已跳过"),3),s.notes?(l(),a("p",we,c(s.notes),1)):u("",!0)]))),128))])):u("",!0),!f.value&&x.value.length===0&&V.value?(l(),a("p",_e," 未找到相关记录。 ")):u("",!0)])])]))}});export{$e as default};
